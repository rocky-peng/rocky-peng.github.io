import{_ as l,$ as i,a0 as u,a1 as n,a2 as a,a3 as s,a4 as e,a5 as c,w as o}from"./framework-349591b1.js";const r={},d=c(`<h2 id="问题描述" tabindex="-1"><a class="header-anchor" href="#问题描述" aria-hidden="true">#</a> 问题描述</h2><p>为了方便说明问题，这里把问题简化下（实际上通过下面简化后的描述就暗示了是部署环境导致的问题，实际情况并没有这么顺利，<strong>中间经历过崩溃、搞不懂、超出认知、持续折腾了一周，各种实验、怀疑过这种问题，比如ingress自动申请的证书问题、ingress没有正确终止ssl，甚至还重新装过k3s，也怀疑过事traefix nginx的问题，哎，反正各种问题都怀疑完了，然后各种验证，崩溃完了</strong>）</p><p>有个nginx，跑了一个前端代码，配置文件大概这样：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>server
<span class="token punctuation">{</span>
    listen <span class="token number">80</span><span class="token punctuation">;</span>
    listen <span class="token number">443</span> ssl  http2<span class="token punctuation">;</span>
    server_name xxxxx.top<span class="token punctuation">;</span>
    index index.php index.html index.htm default.php default.htm default.html<span class="token punctuation">;</span>
    root /www/wwwroot/xxxxx.top<span class="token punctuation">;</span>

    <span class="token comment">#SSL-START SSL相关配置，请勿删除或修改下一行带注释的404规则</span>
    <span class="token comment">#error_page 404/404.html;</span>
    <span class="token comment">#HTTP_TO_HTTPS_START</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$server_port</span> <span class="token operator">!</span>~ <span class="token number">443</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        rewrite ^<span class="token punctuation">(</span>/.*<span class="token punctuation">)</span>$ https://<span class="token variable">$host</span><span class="token variable">$1</span> permanent<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">#HTTP_TO_HTTPS_END</span>
    
    <span class="token comment">#ssl_certificate    /etc/letsencrypt/live/leyong.top/fullchain.pem;</span>
    <span class="token comment">#ssl_certificate_key    /etc/letsencrypt/live/leyong.top/privkey.pem;</span>
    
    ssl_certificate    /root/.acme.sh/xxxxx.top/fullchain.cer<span class="token punctuation">;</span>
    ssl_certificate_key    /root/.acme.sh/xxxxx.top/leyong.top.key<span class="token punctuation">;</span>

    ssl_protocols TLSv1.1 TLSv1.2 TLSv1.3<span class="token punctuation">;</span>
    ssl_ciphers EECDH+CHACHA20:EECDH+CHACHA20-draft:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:<span class="token operator">!</span>MD5<span class="token punctuation">;</span>
    ssl_prefer_server_ciphers on<span class="token punctuation">;</span>
    ssl_session_cache shared:SSL:10m<span class="token punctuation">;</span>
    ssl_session_timeout 10m<span class="token punctuation">;</span>
    add_header Strict-Transport-Security <span class="token string">&quot;max-age=31536000&quot;</span><span class="token punctuation">;</span>
    error_page <span class="token number">497</span>  https://<span class="token variable">$host</span><span class="token variable">$request_uri</span><span class="token punctuation">;</span>
		<span class="token comment">#SSL-END</span>

    <span class="token comment">#ERROR-PAGE-START  错误页配置，可以注释、删除或修改</span>
    <span class="token comment">#error_page 404 /404.html;</span>
    <span class="token comment">#error_page 502 /502.html;</span>
    <span class="token comment">#ERROR-PAGE-END</span>

    <span class="token comment">#PHP-INFO-START  PHP引用配置，可以注释或修改</span>
    include enable-php-00.conf<span class="token punctuation">;</span>
    <span class="token comment">#PHP-INFO-END</span>

    <span class="token comment">#REWRITE-START URL重写规则引用,修改后将导致面板设置的伪静态规则失效</span>
    include /www/server/panel/vhost/rewrite/xxxxx.top.conf<span class="token punctuation">;</span>
    <span class="token comment">#REWRITE-END</span>

    <span class="token comment">#禁止访问的文件或目录</span>
    location ~ ^/<span class="token punctuation">(</span><span class="token punctuation">\\</span>.user.ini<span class="token operator">|</span><span class="token punctuation">\\</span>.htaccess<span class="token operator">|</span><span class="token punctuation">\\</span>.git<span class="token operator">|</span><span class="token punctuation">\\</span>.env<span class="token operator">|</span><span class="token punctuation">\\</span>.svn<span class="token operator">|</span><span class="token punctuation">\\</span>.project<span class="token operator">|</span>LICENSE<span class="token operator">|</span>README.md<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token builtin class-name">return</span> <span class="token number">404</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">#一键申请SSL证书验证目录相关设置</span>
    location ~ <span class="token punctuation">\\</span>.well-known<span class="token punctuation">{</span>
        allow all<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">#禁止在证书验证目录放入敏感文件</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token variable">$uri</span> ~ <span class="token string">&quot;^/\\.well-known/.*\\.(php|jsp|py|js|css|lua|ts|go|zip|tar\\.gz|rar|7z|sql|bak)$&quot;</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token builtin class-name">return</span> <span class="token number">403</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    
    location ^~ /ly <span class="token punctuation">{</span>
        root /www/wwwroot/xxxxx.top<span class="token punctuation">;</span>

        try_files <span class="token variable">$uri</span> /ly/index.html<span class="token punctuation">;</span>
        index  index.html index.htm<span class="token punctuation">;</span>
        error_page <span class="token number">405</span> <span class="token operator">=</span><span class="token number">200</span>	http://<span class="token variable">$host</span><span class="token builtin class-name">:</span><span class="token variable">$server_port</span><span class="token variable">$request_uri</span><span class="token punctuation">;</span>
        error_page <span class="token number">404</span> <span class="token operator">=</span> /404.html<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    location /api <span class="token punctuation">{</span>
        proxy_set_header   Host <span class="token variable">$host</span><span class="token builtin class-name">:</span><span class="token variable">$server_port</span><span class="token punctuation">;</span>
        proxy_redirect off<span class="token punctuation">;</span>
        proxy_set_header X-Real-IP <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>
        proxy_set_header X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span><span class="token punctuation">;</span>
        proxy_connect_timeout <span class="token number">60</span><span class="token punctuation">;</span>
        proxy_read_timeout <span class="token number">600</span><span class="token punctuation">;</span>
        proxy_send_timeout <span class="token number">600</span><span class="token punctuation">;</span>
        proxy_pass http://10.1.12.7:8760/api<span class="token punctuation">;</span>
        <span class="token comment">#proxy_pass http://10.1.12.7:31760/api;</span>
        client_max_body_size 80m<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    access_log  /www/wwwlogs/xxxxx.top.log<span class="token punctuation">;</span>
    error_log  /www/wwwlogs/xxxxx.top.error.log<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,4),k={href:"http://10.1.12.7:8760/api",target:"_blank",rel:"noopener noreferrer"},v={href:"http://a.com/gateway:1.0%EF%BC%8C%E9%83%A8%E7%BD%B2%E7%9A%84%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%86%85%E7%BD%91ip%E6%98%AF%EF%BC%9A10.1.12.7",target:"_blank",rel:"noopener noreferrer"},b={href:"http://a.com/gateway:1.0%EF%BC%8C%E9%80%9A%E8%BF%87k3s%E9%83%A8%E7%BD%B2%E4%BA%86%E4%B8%80%E4%B8%8B%EF%BC%8C%E7%84%B6%E5%90%8E%E9%80%9A%E8%BF%87service%E6%9A%B4%E9%9C%B2%E5%88%B0%E8%8A%82%E7%82%B9%E4%B8%8A%EF%BC%8C%E8%8A%82%E7%82%B9%E7%AB%AF%E5%8F%A3%E6%98%AF31760%EF%BC%8C%E9%82%A3%E4%B9%88%E8%AE%BF%E9%97%AE%E5%9C%B0%E5%9D%80%E5%B0%B1%E6%98%AF%EF%BC%9A",target:"_blank",rel:"noopener noreferrer"},m={href:"http://10.1.12.7:31760/api",target:"_blank",rel:"noopener noreferrer"},h={href:"http://10.1.12.7:8760/api",target:"_blank",rel:"noopener noreferrer"},g={href:"http://10.1.12.7:31760/api",target:"_blank",rel:"noopener noreferrer"},y={href:"https://xxxxx.top/api/xxxxx%E8%BF%9B%E8%A1%8C%E8%AE%BF%E9%97%AE%EF%BC%8C%E5%A5%87%E6%80%AA%E7%9A%84%E4%BA%8B%E6%83%85%E5%8F%91%E7%94%9F%E4%BA%86%EF%BC%8C%E4%BC%9A%E5%87%BA%E7%8E%B0%E8%BF%99%E6%A0%B7%E7%9A%84%E5%BC%82%E5%B8%B8%E4%BF%A1%E6%81%AF%EF%BC%9A",target:"_blank",rel:"noopener noreferrer"},E=c(`<div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>lypqs-gateway-server:8080:0000:1<span class="token punctuation">]</span> <span class="token number">2025</span>-05-18 <span class="token number">21</span>:33:41.183<span class="token punctuation">[</span>DEBUG<span class="token punctuation">]</span> <span class="token number">1</span> <span class="token punctuation">[</span>d63cddef1a164adf9f5eb91b63b9a375<span class="token punctuation">]</span> <span class="token punctuation">[</span>reactor-http-epoll-3:6022325<span class="token punctuation">]</span> <span class="token punctuation">[</span>reactor.netty.http.server.HttpServerOperations.?:?<span class="token punctuation">]</span> <span class="token punctuation">[</span>11dd715f, L:/10.42.0.56:8080 - R:/10.42.0.1:54128<span class="token punctuation">]</span> New http connection, requesting <span class="token builtin class-name">read</span>
<span class="token punctuation">[</span>lypqs-gateway-server:8080:0000:1<span class="token punctuation">]</span> <span class="token number">2025</span>-05-18 <span class="token number">21</span>:33:41.183<span class="token punctuation">[</span>DEBUG<span class="token punctuation">]</span> <span class="token number">1</span> <span class="token punctuation">[</span>d63cddef1a164adf9f5eb91b63b9a375<span class="token punctuation">]</span> <span class="token punctuation">[</span>reactor-http-epoll-3:6022325<span class="token punctuation">]</span> <span class="token punctuation">[</span>reactor.netty.transport.TransportConfig.?:?<span class="token punctuation">]</span> <span class="token punctuation">[</span>11dd715f, L:/10.42.0.56:8080 - R:/10.42.0.1:54128<span class="token punctuation">]</span> Initialized pipeline DefaultChannelPipeline<span class="token punctuation">{</span><span class="token punctuation">(</span>reactor.left.httpCodec <span class="token operator">=</span> io.netty.handler.codec.http.HttpServerCodec<span class="token punctuation">)</span>, <span class="token punctuation">(</span>reactor.left.httpTrafficHandler <span class="token operator">=</span> reactor.netty.http.server.HttpTrafficHandler<span class="token punctuation">)</span>, <span class="token punctuation">(</span>reactor.right.reactiveBridge <span class="token operator">=</span> reactor.netty.channel.ChannelOperationsHandler<span class="token punctuation">)</span><span class="token punctuation">}</span>
<span class="token punctuation">[</span>lypqs-gateway-server:8080:0000:1<span class="token punctuation">]</span> <span class="token number">2025</span>-05-18 <span class="token number">21</span>:33:41.184<span class="token punctuation">[</span>DEBUG<span class="token punctuation">]</span> <span class="token number">1</span> <span class="token punctuation">[</span>d63cddef1a164adf9f5eb91b63b9a375<span class="token punctuation">]</span> <span class="token punctuation">[</span>reactor-http-epoll-3:6022326<span class="token punctuation">]</span> <span class="token punctuation">[</span>reactor.netty.http.server.HttpServerOperations.?:?<span class="token punctuation">]</span> <span class="token punctuation">[</span>11dd715f, L:/10.42.0.56:8080 - R:/10.42.0.1:54128<span class="token punctuation">]</span> Increasing pending responses, now <span class="token number">1</span>
<span class="token punctuation">[</span>lypqs-gateway-server:8080:0000:1<span class="token punctuation">]</span> <span class="token number">2025</span>-05-18 <span class="token number">21</span>:33:41.184<span class="token punctuation">[</span>DEBUG<span class="token punctuation">]</span> <span class="token number">1</span> <span class="token punctuation">[</span>d63cddef1a164adf9f5eb91b63b9a375<span class="token punctuation">]</span> <span class="token punctuation">[</span>reactor-http-epoll-3:6022326<span class="token punctuation">]</span> <span class="token punctuation">[</span>reactor.netty.http.server.HttpServer.?:?<span class="token punctuation">]</span> <span class="token punctuation">[</span>11dd715f-1, L:/10.42.0.56:8080 - R:/10.42.0.1:54128<span class="token punctuation">]</span> Handler is being applied: org.springframework.http.server.reactive.ReactorHttpHandlerAdapter@38382b69
<span class="token punctuation">[</span>lypqs-gateway-server:8080:0000:1<span class="token punctuation">]</span> <span class="token number">2025</span>-05-18 <span class="token number">21</span>:33:41.189<span class="token punctuation">[</span>TRACE<span class="token punctuation">]</span> <span class="token number">1</span> <span class="token punctuation">[</span>711e1083010c4aeb9991b6ba60f174d2<span class="token punctuation">]</span> <span class="token punctuation">[</span>reactor-http-epoll-3:6022331<span class="token punctuation">]</span> <span class="token punctuation">[</span>o.s.cloud.gateway.filter.WeightCalculatorWebFilter.?:?<span class="token punctuation">]</span> Weights attr: <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">[</span>lypqs-gateway-server:8080:0000:1<span class="token punctuation">]</span> <span class="token number">2025</span>-05-18 <span class="token number">21</span>:33:41.190<span class="token punctuation">[</span>TRACE<span class="token punctuation">]</span> <span class="token number">1</span> <span class="token punctuation">[</span>711e1083010c4aeb9991b6ba60f174d2<span class="token punctuation">]</span> <span class="token punctuation">[</span>reactor-http-epoll-3:6022332<span class="token punctuation">]</span> <span class="token punctuation">[</span>o.s.c.g.h.predicate.PathRoutePredicateFactory.?:?<span class="token punctuation">]</span> Pattern <span class="token string">&quot;[/lypqs-oauth-server/**]&quot;</span> does not match against value <span class="token string">&quot;/oauth/resource/visible&quot;</span>
<span class="token punctuation">[</span>lypqs-gateway-server:8080:0000:1<span class="token punctuation">]</span> <span class="token number">2025</span>-05-18 <span class="token number">21</span>:33:41.190<span class="token punctuation">[</span>TRACE<span class="token punctuation">]</span> <span class="token number">1</span> <span class="token punctuation">[</span>711e1083010c4aeb9991b6ba60f174d2<span class="token punctuation">]</span> <span class="token punctuation">[</span>reactor-http-epoll-3:6022332<span class="token punctuation">]</span> <span class="token punctuation">[</span>o.s.c.g.h.predicate.PathRoutePredicateFactory.?:?<span class="token punctuation">]</span> Pattern <span class="token string">&quot;[/lypqs-gateway-server/**]&quot;</span> does not match against value <span class="token string">&quot;/oauth/resource/visible&quot;</span>
<span class="token punctuation">[</span>lypqs-gateway-server:8080:0000:1<span class="token punctuation">]</span> <span class="token number">2025</span>-05-18 <span class="token number">21</span>:33:41.190<span class="token punctuation">[</span>TRACE<span class="token punctuation">]</span> <span class="token number">1</span> <span class="token punctuation">[</span>711e1083010c4aeb9991b6ba60f174d2<span class="token punctuation">]</span> <span class="token punctuation">[</span>reactor-http-epoll-3:6022332<span class="token punctuation">]</span> <span class="token punctuation">[</span>o.s.c.g.h.predicate.PathRoutePredicateFactory.?:?<span class="token punctuation">]</span> Pattern <span class="token string">&quot;/oauth/**&quot;</span> matches against value <span class="token string">&quot;/oauth/resource/visible&quot;</span>
<span class="token punctuation">[</span>lypqs-gateway-server:8080:0000:1<span class="token punctuation">]</span> <span class="token number">2025</span>-05-18 <span class="token number">21</span>:33:41.190<span class="token punctuation">[</span>DEBUG<span class="token punctuation">]</span> <span class="token number">1</span> <span class="token punctuation">[</span>711e1083010c4aeb9991b6ba60f174d2<span class="token punctuation">]</span> <span class="token punctuation">[</span>reactor-http-epoll-3:6022332<span class="token punctuation">]</span> <span class="token punctuation">[</span>o.s.c.gateway.handler.RoutePredicateHandlerMapping.?:?<span class="token punctuation">]</span> Route matched: oauth
<span class="token punctuation">[</span>lypqs-gateway-server:8080:0000:1<span class="token punctuation">]</span> <span class="token number">2025</span>-05-18 <span class="token number">21</span>:33:41.191<span class="token punctuation">[</span>DEBUG<span class="token punctuation">]</span> <span class="token number">1</span> <span class="token punctuation">[</span>711e1083010c4aeb9991b6ba60f174d2<span class="token punctuation">]</span> <span class="token punctuation">[</span>reactor-http-epoll-3:6022333<span class="token punctuation">]</span> <span class="token punctuation">[</span>o.s.c.gateway.handler.RoutePredicateHandlerMapping.?:?<span class="token punctuation">]</span> Mapping <span class="token punctuation">[</span>Exchange: GET https://xxxxx.top/oauth/resource/visible?ts<span class="token operator">=</span><span class="token number">1747227403065</span><span class="token operator">&amp;</span><span class="token assign-left variable">resourceType</span><span class="token operator">=</span>ADMIN_RESOURCE<span class="token operator">&amp;</span><span class="token assign-left variable">changeHttpsToHttp</span><span class="token operator">=</span>false<span class="token punctuation">]</span> to Route<span class="token punctuation">{</span>id<span class="token operator">=</span><span class="token string">&#39;oauth&#39;</span>, <span class="token assign-left variable">uri</span><span class="token operator">=</span>lb://lypqs-oauth-server, <span class="token assign-left variable">order</span><span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">predicate</span><span class="token operator">=</span>Paths: <span class="token punctuation">[</span>/oauth/**<span class="token punctuation">]</span>, match trailing slash: true, <span class="token assign-left variable">gatewayFilters</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span>StripPrefix parts <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">]</span>, order <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span>, <span class="token assign-left variable">metadata</span><span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">[</span>lypqs-gateway-server:8080:0000:1<span class="token punctuation">]</span> <span class="token number">2025</span>-05-18 <span class="token number">21</span>:33:41.191<span class="token punctuation">[</span>DEBUG<span class="token punctuation">]</span> <span class="token number">1</span> <span class="token punctuation">[</span>711e1083010c4aeb9991b6ba60f174d2<span class="token punctuation">]</span> <span class="token punctuation">[</span>reactor-http-epoll-3:6022333<span class="token punctuation">]</span> <span class="token punctuation">[</span>o.s.c.gateway.handler.RoutePredicateHandlerMapping.?:?<span class="token punctuation">]</span> <span class="token punctuation">[</span>11dd715f-1<span class="token punctuation">]</span> Mapped to org.springframework.cloud.gateway.handler.FilteringWebHandler@539725a5
<span class="token punctuation">[</span>lypqs-gateway-server:8080:0000:1<span class="token punctuation">]</span> <span class="token number">2025</span>-05-18 <span class="token number">21</span>:33:41.191<span class="token punctuation">[</span>DEBUG<span class="token punctuation">]</span> <span class="token number">1</span> <span class="token punctuation">[</span>711e1083010c4aeb9991b6ba60f174d2<span class="token punctuation">]</span> <span class="token punctuation">[</span>reactor-http-epoll-3:6022333<span class="token punctuation">]</span> <span class="token punctuation">[</span>o.s.cloud.gateway.handler.FilteringWebHandler.?:?<span class="token punctuation">]</span> Sorted gatewayFilterFactories: <span class="token punctuation">[</span><span class="token punctuation">[</span>GatewayFilterAdapter<span class="token punctuation">{</span>delegate<span class="token operator">=</span>org.springframework.cloud.gateway.filter.RemoveCachedBodyFilter@12d40609<span class="token punctuation">}</span>, order <span class="token operator">=</span> -2147483648<span class="token punctuation">]</span>, <span class="token punctuation">[</span>GatewayFilterAdapter<span class="token punctuation">{</span>delegate<span class="token operator">=</span>org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7dee835<span class="token punctuation">}</span>, order <span class="token operator">=</span> -2147482648<span class="token punctuation">]</span>, <span class="token punctuation">[</span>GatewayFilterAdapter<span class="token punctuation">{</span>delegate<span class="token operator">=</span>org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@7fb8bad0<span class="token punctuation">}</span>, order <span class="token operator">=</span> -1<span class="token punctuation">]</span>, <span class="token punctuation">[</span>GatewayFilterAdapter<span class="token punctuation">{</span>delegate<span class="token operator">=</span>org.springframework.cloud.gateway.filter.ForwardPathFilter@193eb1ba<span class="token punctuation">}</span>, order <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">]</span>, <span class="token punctuation">[</span>GatewayFilterAdapter<span class="token punctuation">{</span>delegate<span class="token operator">=</span>org.springframework.cloud.gateway.filter.GatewayMetricsFilter@46320c9a<span class="token punctuation">}</span>, order <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">]</span>, <span class="token punctuation">[</span><span class="token punctuation">[</span>StripPrefix parts <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">]</span>, order <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">]</span>, <span class="token punctuation">[</span>GatewayFilterAdapter<span class="token punctuation">{</span>delegate<span class="token operator">=</span>org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@76437e9b<span class="token punctuation">}</span>, order <span class="token operator">=</span> <span class="token number">10000</span><span class="token punctuation">]</span>, <span class="token punctuation">[</span>GatewayFilterAdapter<span class="token punctuation">{</span>delegate<span class="token operator">=</span>top.tangyh.lypqs.gateway.filter.GrayscaleReactiveLoadBalancerClientFilter@8fd91d1<span class="token punctuation">}</span>, order <span class="token operator">=</span> <span class="token number">10150</span><span class="token punctuation">]</span>, <span class="token punctuation">[</span>GatewayFilterAdapter<span class="token punctuation">{</span>delegate<span class="token operator">=</span>org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@2be818da<span class="token punctuation">}</span>, order <span class="token operator">=</span> <span class="token number">2147483646</span><span class="token punctuation">]</span>, <span class="token punctuation">[</span>GatewayFilterAdapter<span class="token punctuation">{</span>delegate<span class="token operator">=</span>org.springframework.cloud.gateway.filter.NettyRoutingFilter@52d0f583<span class="token punctuation">}</span>, order <span class="token operator">=</span> <span class="token number">2147483647</span><span class="token punctuation">]</span>, <span class="token punctuation">[</span>GatewayFilterAdapter<span class="token punctuation">{</span>delegate<span class="token operator">=</span>org.springframework.cloud.gateway.filter.ForwardRoutingFilter@236ae13d<span class="token punctuation">}</span>, order <span class="token operator">=</span> <span class="token number">2147483647</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span>lypqs-gateway-server:8080:0000:1<span class="token punctuation">]</span> <span class="token number">2025</span>-05-18 <span class="token number">21</span>:33:41.191<span class="token punctuation">[</span>TRACE<span class="token punctuation">]</span> <span class="token number">1</span> <span class="token punctuation">[</span>711e1083010c4aeb9991b6ba60f174d2<span class="token punctuation">]</span> <span class="token punctuation">[</span>reactor-http-epoll-3:6022333<span class="token punctuation">]</span> <span class="token punctuation">[</span>o.s.cloud.gateway.filter.RouteToRequestUrlFilter.?:?<span class="token punctuation">]</span> RouteToRequestUrlFilter start
<span class="token punctuation">[</span>lypqs-gateway-server:8080:0000:1<span class="token punctuation">]</span> <span class="token number">2025</span>-05-18 <span class="token number">21</span>:33:41.193<span class="token punctuation">[</span>DEBUG<span class="token punctuation">]</span> <span class="token number">1</span> <span class="token punctuation">[</span>711e1083010c4aeb9991b6ba60f174d2<span class="token punctuation">]</span> <span class="token punctuation">[</span>reactor-http-epoll-3:6022335<span class="token punctuation">]</span> <span class="token punctuation">[</span>reactor.netty.resources.PooledConnectionProvider.?:?<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token number">73863284</span><span class="token punctuation">]</span> Created a new pooled channel, now: <span class="token number">0</span> active connections, <span class="token number">0</span> inactive connections and <span class="token number">0</span> pending acquire requests.
<span class="token punctuation">[</span>lypqs-gateway-server:8080:0000:1<span class="token punctuation">]</span> <span class="token number">2025</span>-05-18 <span class="token number">21</span>:33:41.193<span class="token punctuation">[</span>DEBUG<span class="token punctuation">]</span> <span class="token number">1</span> <span class="token punctuation">[</span>711e1083010c4aeb9991b6ba60f174d2<span class="token punctuation">]</span> <span class="token punctuation">[</span>reactor-http-epoll-3:6022335<span class="token punctuation">]</span> <span class="token punctuation">[</span>reactor.netty.tcp.SslProvider.?:?<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token number">73863284</span><span class="token punctuation">]</span> SSL enabled using engine sun.security.ssl.SSLEngineImpl@3a9ca0f7 and SNI /10.42.0.50:8080
<span class="token punctuation">[</span>lypqs-gateway-server:8080:0000:1<span class="token punctuation">]</span> <span class="token number">2025</span>-05-18 <span class="token number">21</span>:33:41.193<span class="token punctuation">[</span>DEBUG<span class="token punctuation">]</span> <span class="token number">1</span> <span class="token punctuation">[</span>711e1083010c4aeb9991b6ba60f174d2<span class="token punctuation">]</span> <span class="token punctuation">[</span>reactor-http-epoll-3:6022335<span class="token punctuation">]</span> <span class="token punctuation">[</span>reactor.netty.transport.TransportConfig.?:?<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token number">73863284</span><span class="token punctuation">]</span> Initialized pipeline DefaultChannelPipeline<span class="token punctuation">{</span><span class="token punctuation">(</span>reactor.left.sslHandler <span class="token operator">=</span> io.netty.handler.ssl.SslHandler<span class="token punctuation">)</span>, <span class="token punctuation">(</span>reactor.left.sslReader <span class="token operator">=</span> reactor.netty.tcp.SslProvider<span class="token variable">$SslReadHandler</span><span class="token punctuation">)</span>, <span class="token punctuation">(</span>reactor.left.httpCodec <span class="token operator">=</span> io.netty.handler.codec.http.HttpClientCodec<span class="token punctuation">)</span>, <span class="token punctuation">(</span>reactor.right.reactiveBridge <span class="token operator">=</span> reactor.netty.channel.ChannelOperationsHandler<span class="token punctuation">)</span><span class="token punctuation">}</span>
<span class="token punctuation">[</span>lypqs-gateway-server:8080:0000:1<span class="token punctuation">]</span> <span class="token number">2025</span>-05-18 <span class="token number">21</span>:33:41.194<span class="token punctuation">[</span>DEBUG<span class="token punctuation">]</span> <span class="token number">1</span> <span class="token punctuation">[</span>711e1083010c4aeb9991b6ba60f174d2<span class="token punctuation">]</span> <span class="token punctuation">[</span>reactor-http-epoll-3:6022336<span class="token punctuation">]</span> <span class="token punctuation">[</span>reactor.netty.transport.TransportConnector.?:?<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token number">73863284</span><span class="token punctuation">]</span> Connecting to <span class="token punctuation">[</span>/10.42.0.50:8080<span class="token punctuation">]</span>.
<span class="token punctuation">[</span>lypqs-gateway-server:8080:0000:1<span class="token punctuation">]</span> <span class="token number">2025</span>-05-18 <span class="token number">21</span>:33:41.194<span class="token punctuation">[</span>DEBUG<span class="token punctuation">]</span> <span class="token number">1</span> <span class="token punctuation">[</span>711e1083010c4aeb9991b6ba60f174d2<span class="token punctuation">]</span> <span class="token punctuation">[</span>reactor-http-epoll-3:6022336<span class="token punctuation">]</span> <span class="token punctuation">[</span>r.netty.resources.DefaultPooledConnectionProvider.?:?<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token number">73863284</span>, L:/10.42.0.56:59796 - R:10.42.0.50/10.42.0.50:8080<span class="token punctuation">]</span> Registering pool release on close event <span class="token keyword">for</span> channel
<span class="token punctuation">[</span>lypqs-gateway-server:8080:0000:1<span class="token punctuation">]</span> <span class="token number">2025</span>-05-18 <span class="token number">21</span>:33:41.194<span class="token punctuation">[</span>DEBUG<span class="token punctuation">]</span> <span class="token number">1</span> <span class="token punctuation">[</span>711e1083010c4aeb9991b6ba60f174d2<span class="token punctuation">]</span> <span class="token punctuation">[</span>reactor-http-epoll-3:6022336<span class="token punctuation">]</span> <span class="token punctuation">[</span>reactor.netty.resources.PooledConnectionProvider.?:?<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token number">73863284</span>, L:/10.42.0.56:59796 - R:10.42.0.50/10.42.0.50:8080<span class="token punctuation">]</span> Channel connected, now: <span class="token number">1</span> active connections, <span class="token number">0</span> inactive connections and <span class="token number">0</span> pending acquire requests.
<span class="token punctuation">[</span>lypqs-gateway-server:8080:0000:1<span class="token punctuation">]</span> <span class="token number">2025</span>-05-18 <span class="token number">21</span>:33:41.198<span class="token punctuation">[</span>ERROR<span class="token punctuation">]</span> <span class="token number">1</span> <span class="token punctuation">[</span>711e1083010c4aeb9991b6ba60f174d2<span class="token punctuation">]</span> <span class="token punctuation">[</span>reactor-http-epoll-3:6022340<span class="token punctuation">]</span> <span class="token punctuation">[</span>o.s.b.a.w.r.error.AbstractErrorWebExceptionHandler.?:?<span class="token punctuation">]</span> <span class="token punctuation">[</span>11dd715f-1<span class="token punctuation">]</span>  <span class="token number">500</span> Server Error <span class="token keyword">for</span> HTTP GET <span class="token string">&quot;/api/oauth/resource/visible?ts=1747227403065&amp;resourceType=ADMIN_RESOURCE&amp;changeHttpsToHttp=false&quot;</span>

io.netty.handler.ssl.NotSslRecordException: not an SSL/TLS record: 485454502f312e31203430302042616420526571756573740d0a436f6e74656e742d4c656e6774683a20300d0a436f6e6e656374696f6e3a20636c6f73650d0a0d0a
        at io.netty.handler.ssl.SslHandler.decodeJdkCompatible<span class="token punctuation">(</span>SslHandler.java:1214<span class="token punctuation">)</span>
        Suppressed: reactor.core.publisher.FluxOnAssembly<span class="token variable">$OnAssemblyException</span><span class="token builtin class-name">:</span> 
Error has been observed at the following site<span class="token punctuation">(</span>s<span class="token punctuation">)</span>:
        *__checkpoint ⇢ top.tangyh.lypqs.gateway.filter.AccessLogFilter <span class="token punctuation">[</span>DefaultWebFilterChain<span class="token punctuation">]</span>
        *__checkpoint ⇢ org.springframework.cloud.gateway.filter.WeightCalculatorWebFilter <span class="token punctuation">[</span>DefaultWebFilterChain<span class="token punctuation">]</span>
        *__checkpoint ⇢ com.alibaba.csp.sentinel.adapter.spring.webflux.SentinelWebFluxFilter <span class="token punctuation">[</span>DefaultWebFilterChain<span class="token punctuation">]</span>
        *__checkpoint ⇢ top.tangyh.lypqs.gateway.filter.TokenContextFilter <span class="token punctuation">[</span>DefaultWebFilterChain<span class="token punctuation">]</span>
        *__checkpoint ⇢ top.tangyh.lypqs.gateway.filter.ContextPathFilter <span class="token punctuation">[</span>DefaultWebFilterChain<span class="token punctuation">]</span>
        *__checkpoint ⇢ org.springframework.boot.actuate.metrics.web.reactive.server.MetricsWebFilter <span class="token punctuation">[</span>DefaultWebFilterChain<span class="token punctuation">]</span>
        *__checkpoint ⇢ top.tangyh.lypqs.gateway.config.CorsConfiguration<span class="token variable">$$</span>Lambda<span class="token variable">$811</span>/0x00000008408ebc40 <span class="token punctuation">[</span>DefaultWebFilterChain<span class="token punctuation">]</span>
        *__checkpoint ⇢ top.tangyh.lypqs.gateway.filter.TraceFilter <span class="token punctuation">[</span>DefaultWebFilterChain<span class="token punctuation">]</span>
        *__checkpoint ⇢ HTTP GET <span class="token string">&quot;/api/oauth/resource/visible?ts=1747227403065&amp;resourceType=ADMIN_RESOURCE&amp;changeHttpsToHttp=false&quot;</span> <span class="token punctuation">[</span>ExceptionHandlingWebHandler<span class="token punctuation">]</span>
Original Stack Trace:
                at io.netty.handler.ssl.SslHandler.decodeJdkCompatible<span class="token punctuation">(</span>SslHandler.java:1214<span class="token punctuation">)</span>
                at io.netty.handler.ssl.SslHandler.decode<span class="token punctuation">(</span>SslHandler.java:1284<span class="token punctuation">)</span>
                at io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection<span class="token punctuation">(</span>ByteToMessageDecoder.java:507<span class="token punctuation">)</span>
                at io.netty.handler.codec.ByteToMessageDecoder.callDecode<span class="token punctuation">(</span>ByteToMessageDecoder.java:446<span class="token punctuation">)</span>
                at io.netty.handler.codec.ByteToMessageDecoder.channelRead<span class="token punctuation">(</span>ByteToMessageDecoder.java:276<span class="token punctuation">)</span>
                at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead<span class="token punctuation">(</span>AbstractChannelHandlerContext.java:379<span class="token punctuation">)</span>
                at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead<span class="token punctuation">(</span>AbstractChannelHandlerContext.java:365<span class="token punctuation">)</span>
                at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead<span class="token punctuation">(</span>AbstractChannelHandlerContext.java:357<span class="token punctuation">)</span>
                at io.netty.channel.DefaultChannelPipeline<span class="token variable">$HeadContext</span>.channelRead<span class="token punctuation">(</span>DefaultChannelPipeline.java:1410<span class="token punctuation">)</span>
                at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead<span class="token punctuation">(</span>AbstractChannelHandlerContext.java:379<span class="token punctuation">)</span>
                at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead<span class="token punctuation">(</span>AbstractChannelHandlerContext.java:365<span class="token punctuation">)</span>
                at io.netty.channel.DefaultChannelPipeline.fireChannelRead<span class="token punctuation">(</span>DefaultChannelPipeline.java:919<span class="token punctuation">)</span>
                at io.netty.channel.epoll.AbstractEpollStreamChannel<span class="token variable">$EpollStreamUnsafe</span>.epollInReady<span class="token punctuation">(</span>AbstractEpollStreamChannel.java:795<span class="token punctuation">)</span>
                at io.netty.channel.epoll.EpollEventLoop.processReady<span class="token punctuation">(</span>EpollEventLoop.java:480<span class="token punctuation">)</span>
                at io.netty.channel.epoll.EpollEventLoop.run<span class="token punctuation">(</span>EpollEventLoop.java:378<span class="token punctuation">)</span>
                at io.netty.util.concurrent.SingleThreadEventExecutor<span class="token variable">$4</span>.run<span class="token punctuation">(</span>SingleThreadEventExecutor.java:986<span class="token punctuation">)</span>
                at io.netty.util.internal.ThreadExecutorMap<span class="token variable">$2</span>.run<span class="token punctuation">(</span>ThreadExecutorMap.java:74<span class="token punctuation">)</span>
                at io.netty.util.concurrent.FastThreadLocalRunnable.run<span class="token punctuation">(</span>FastThreadLocalRunnable.java:30<span class="token punctuation">)</span>
                at java.base/java.lang.Thread.run<span class="token punctuation">(</span>Thread.java:829<span class="token punctuation">)</span>

<span class="token punctuation">[</span>lypqs-gateway-server:8080:0000:1<span class="token punctuation">]</span> <span class="token number">2025</span>-05-18 <span class="token number">21</span>:33:41.199<span class="token punctuation">[</span>TRACE<span class="token punctuation">]</span> <span class="token number">1</span> <span class="token punctuation">[</span>711e1083010c4aeb9991b6ba60f174d2<span class="token punctuation">]</span> <span class="token punctuation">[</span>reactor-http-epoll-3:6022341<span class="token punctuation">]</span> <span class="token punctuation">[</span>o.s.cloud.gateway.filter.GatewayMetricsFilter.?:?<span class="token punctuation">]</span> spring.cloud.gateway.requests tags: <span class="token punctuation">[</span>tag<span class="token punctuation">(</span>httpMethod<span class="token operator">=</span>GET<span class="token punctuation">)</span>,tag<span class="token punctuation">(</span>httpStatusCode<span class="token operator">=</span><span class="token number">500</span><span class="token punctuation">)</span>,tag<span class="token punctuation">(</span>outcome<span class="token operator">=</span>SERVER_ERROR<span class="token punctuation">)</span>,tag<span class="token punctuation">(</span>routeId<span class="token operator">=</span>oauth<span class="token punctuation">)</span>,tag<span class="token punctuation">(</span>routeUri<span class="token operator">=</span>lb://lypqs-oauth-server<span class="token punctuation">)</span>,tag<span class="token punctuation">(</span>status<span class="token operator">=</span>INTERNAL_SERVER_ERROR<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span>lypqs-gateway-server:8080:0000:1<span class="token punctuation">]</span> <span class="token number">2025</span>-05-18 <span class="token number">21</span>:33:41.200<span class="token punctuation">[</span>DEBUG<span class="token punctuation">]</span> <span class="token number">1</span> <span class="token punctuation">[</span>711e1083010c4aeb9991b6ba60f174d2<span class="token punctuation">]</span> <span class="token punctuation">[</span>reactor-http-epoll-3:6022342<span class="token punctuation">]</span> <span class="token punctuation">[</span>reactor.netty.http.server.HttpServerOperations.?:?<span class="token punctuation">]</span> <span class="token punctuation">[</span>11dd715f-1, L:/10.42.0.56:8080 - R:/10.42.0.1:54128<span class="token punctuation">]</span> Decreasing pending responses, now <span class="token number">0</span>
<span class="token punctuation">[</span>lypqs-gateway-server:8080:0000:1<span class="token punctuation">]</span> <span class="token number">2025</span>-05-18 <span class="token number">21</span>:33:41.200<span class="token punctuation">[</span>DEBUG<span class="token punctuation">]</span> <span class="token number">1</span> <span class="token punctuation">[</span>711e1083010c4aeb9991b6ba60f174d2<span class="token punctuation">]</span> <span class="token punctuation">[</span>reactor-http-epoll-3:6022342<span class="token punctuation">]</span> <span class="token punctuation">[</span>reactor.netty.http.server.HttpServerOperations.?:?<span class="token punctuation">]</span> <span class="token punctuation">[</span>11dd715f-1, L:/10.42.0.56:8080 - R:/10.42.0.1:54128<span class="token punctuation">]</span> Last HTTP packet was sent, terminating the channel
<span class="token punctuation">[</span>lypqs-gateway-server:8080:0000:1<span class="token punctuation">]</span> <span class="token number">2025</span>-05-18 <span class="token number">21</span>:33:41.200<span class="token punctuation">[</span>DEBUG<span class="token punctuation">]</span> <span class="token number">1</span> <span class="token punctuation">[</span>711e1083010c4aeb9991b6ba60f174d2<span class="token punctuation">]</span> <span class="token punctuation">[</span>reactor-http-epoll-3:6022342<span class="token punctuation">]</span> <span class="token punctuation">[</span>reactor.netty.http.server.HttpServerOperations.?:?<span class="token punctuation">]</span> <span class="token punctuation">[</span>11dd715f-1, L:/10.42.0.56:8080 - R:/10.42.0.1:54128<span class="token punctuation">]</span> Last HTTP response frame
<span class="token punctuation">[</span>lypqs-gateway-server:8080:0000:1<span class="token punctuation">]</span> <span class="token number">2025</span>-05-18 <span class="token number">21</span>:33:41.201<span class="token punctuation">[</span> WARN<span class="token punctuation">]</span> <span class="token number">1</span> <span class="token punctuation">[</span>711e1083010c4aeb9991b6ba60f174d2<span class="token punctuation">]</span> <span class="token punctuation">[</span>reactor-http-epoll-3:6022343<span class="token punctuation">]</span> <span class="token punctuation">[</span>reactor.netty.http.client.HttpClientConnect.?:?<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token number">73863284</span>, L:/10.42.0.56:59796 - R:10.42.0.50/10.42.0.50:8080<span class="token punctuation">]</span> The connection observed an error

io.netty.handler.ssl.NotSslRecordException: not an SSL/TLS record: 485454502f312e31203430302042616420526571756573740d0a436f6e74656e742d4c656e6774683a20300d0a436f6e6e656374696f6e3a20636c6f73650d0a0d0a
        at io.netty.handler.ssl.SslHandler.decodeJdkCompatible<span class="token punctuation">(</span>SslHandler.java:1214<span class="token punctuation">)</span>
        Suppressed: reactor.core.publisher.FluxOnAssembly<span class="token variable">$OnAssemblyException</span><span class="token builtin class-name">:</span> 
Error has been observed at the following site<span class="token punctuation">(</span>s<span class="token punctuation">)</span>:
        *__checkpoint ⇢ top.tangyh.lypqs.gateway.filter.AccessLogFilter <span class="token punctuation">[</span>DefaultWebFilterChain<span class="token punctuation">]</span>
        *__checkpoint ⇢ org.springframework.cloud.gateway.filter.WeightCalculatorWebFilter <span class="token punctuation">[</span>DefaultWebFilterChain<span class="token punctuation">]</span>
        *__checkpoint ⇢ com.alibaba.csp.sentinel.adapter.spring.webflux.SentinelWebFluxFilter <span class="token punctuation">[</span>DefaultWebFilterChain<span class="token punctuation">]</span>
        *__checkpoint ⇢ top.tangyh.lypqs.gateway.filter.TokenContextFilter <span class="token punctuation">[</span>DefaultWebFilterChain<span class="token punctuation">]</span>
        *__checkpoint ⇢ top.tangyh.lypqs.gateway.filter.ContextPathFilter <span class="token punctuation">[</span>DefaultWebFilterChain<span class="token punctuation">]</span>
        *__checkpoint ⇢ org.springframework.boot.actuate.metrics.web.reactive.server.MetricsWebFilter <span class="token punctuation">[</span>DefaultWebFilterChain<span class="token punctuation">]</span>
        *__checkpoint ⇢ top.tangyh.lypqs.gateway.config.CorsConfiguration<span class="token variable">$$</span>Lambda<span class="token variable">$811</span>/0x00000008408ebc40 <span class="token punctuation">[</span>DefaultWebFilterChain<span class="token punctuation">]</span>
        *__checkpoint ⇢ top.tangyh.lypqs.gateway.filter.TraceFilter <span class="token punctuation">[</span>DefaultWebFilterChain<span class="token punctuation">]</span>
        *__checkpoint ⇢ HTTP GET <span class="token string">&quot;/api/oauth/resource/visible?ts=1747227403065&amp;resourceType=ADMIN_RESOURCE&amp;changeHttpsToHttp=false&quot;</span> <span class="token punctuation">[</span>ExceptionHandlingWebHandler<span class="token punctuation">]</span>
Original Stack Trace:
                at io.netty.handler.ssl.SslHandler.decodeJdkCompatible<span class="token punctuation">(</span>SslHandler.java:1214<span class="token punctuation">)</span>
                at io.netty.handler.ssl.SslHandler.decode<span class="token punctuation">(</span>SslHandler.java:1284<span class="token punctuation">)</span>
                at io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection<span class="token punctuation">(</span>ByteToMessageDecoder.java:507<span class="token punctuation">)</span>
                at io.netty.handler.codec.ByteToMessageDecoder.callDecode<span class="token punctuation">(</span>ByteToMessageDecoder.java:446<span class="token punctuation">)</span>
                at io.netty.handler.codec.ByteToMessageDecoder.channelRead<span class="token punctuation">(</span>ByteToMessageDecoder.java:276<span class="token punctuation">)</span>
                at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead<span class="token punctuation">(</span>AbstractChannelHandlerContext.java:379<span class="token punctuation">)</span>
                at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead<span class="token punctuation">(</span>AbstractChannelHandlerContext.java:365<span class="token punctuation">)</span>
                at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead<span class="token punctuation">(</span>AbstractChannelHandlerContext.java:357<span class="token punctuation">)</span>
                at io.netty.channel.DefaultChannelPipeline<span class="token variable">$HeadContext</span>.channelRead<span class="token punctuation">(</span>DefaultChannelPipeline.java:1410<span class="token punctuation">)</span>
                at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead<span class="token punctuation">(</span>AbstractChannelHandlerContext.java:379<span class="token punctuation">)</span>
                at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead<span class="token punctuation">(</span>AbstractChannelHandlerContext.java:365<span class="token punctuation">)</span>
                at io.netty.channel.DefaultChannelPipeline.fireChannelRead<span class="token punctuation">(</span>DefaultChannelPipeline.java:919<span class="token punctuation">)</span>
                at io.netty.channel.epoll.AbstractEpollStreamChannel<span class="token variable">$EpollStreamUnsafe</span>.epollInReady<span class="token punctuation">(</span>AbstractEpollStreamChannel.java:795<span class="token punctuation">)</span>
                at io.netty.channel.epoll.EpollEventLoop.processReady<span class="token punctuation">(</span>EpollEventLoop.java:480<span class="token punctuation">)</span>
                at io.netty.channel.epoll.EpollEventLoop.run<span class="token punctuation">(</span>EpollEventLoop.java:378<span class="token punctuation">)</span>
                at io.netty.util.concurrent.SingleThreadEventExecutor<span class="token variable">$4</span>.run<span class="token punctuation">(</span>SingleThreadEventExecutor.java:986<span class="token punctuation">)</span>
                at io.netty.util.internal.ThreadExecutorMap<span class="token variable">$2</span>.run<span class="token punctuation">(</span>ThreadExecutorMap.java:74<span class="token punctuation">)</span>
                at io.netty.util.concurrent.FastThreadLocalRunnable.run<span class="token punctuation">(</span>FastThreadLocalRunnable.java:30<span class="token punctuation">)</span>
                at java.base/java.lang.Thread.run<span class="token punctuation">(</span>Thread.java:829<span class="token punctuation">)</span>

<span class="token punctuation">[</span>lypqs-gateway-server:8080:0000:1<span class="token punctuation">]</span> <span class="token number">2025</span>-05-18 <span class="token number">21</span>:33:41.201<span class="token punctuation">[</span>DEBUG<span class="token punctuation">]</span> <span class="token number">1</span> <span class="token punctuation">[</span>711e1083010c4aeb9991b6ba60f174d2<span class="token punctuation">]</span> <span class="token punctuation">[</span>reactor-http-epoll-3:6022343<span class="token punctuation">]</span> <span class="token punctuation">[</span>reactor.netty.resources.PooledConnectionProvider.?:?<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token number">73863284</span>, L:/10.42.0.56:59796 <span class="token operator">!</span> R:10.42.0.50/10.42.0.50:8080<span class="token punctuation">]</span> Channel closed, now: <span class="token number">0</span> active connections, <span class="token number">0</span> inactive connections and <span class="token number">0</span> pending acquire requests.
<span class="token punctuation">[</span>lypqs-gateway-server:8080:0000:1<span class="token punctuation">]</span> <span class="token number">2025</span>-05-18 <span class="token number">21</span>:33:41.201<span class="token punctuation">[</span> WARN<span class="token punctuation">]</span> <span class="token number">1</span> <span class="token punctuation">[</span>711e1083010c4aeb9991b6ba60f174d2<span class="token punctuation">]</span> <span class="token punctuation">[</span>reactor-http-epoll-3:6022343<span class="token punctuation">]</span> <span class="token punctuation">[</span>reactor.netty.http.client.HttpClientConnect.?:?<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token number">73863284</span>, L:/10.42.0.56:59796 <span class="token operator">!</span> R:10.42.0.50/10.42.0.50:8080<span class="token punctuation">]</span> The connection observed an error

io.netty.handler.codec.DecoderException: io.netty.handler.ssl.NotSslRecordException: not an SSL/TLS record: 485454502f312e31203430302042616420526571756573740d0a436f6e74656e742d4c656e6774683a20300d0a436f6e6e656374696f6e3a20636c6f73650d0a0d0a
        at io.netty.handler.codec.ByteToMessageDecoder.callDecode<span class="token punctuation">(</span>ByteToMessageDecoder.java:477<span class="token punctuation">)</span>
        at io.netty.handler.codec.ByteToMessageDecoder.channelRead<span class="token punctuation">(</span>ByteToMessageDecoder.java:276<span class="token punctuation">)</span>
        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead<span class="token punctuation">(</span>AbstractChannelHandlerContext.java:379<span class="token punctuation">)</span>
        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead<span class="token punctuation">(</span>AbstractChannelHandlerContext.java:365<span class="token punctuation">)</span>
        at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead<span class="token punctuation">(</span>AbstractChannelHandlerContext.java:357<span class="token punctuation">)</span>
        at io.netty.channel.DefaultChannelPipeline<span class="token variable">$HeadContext</span>.channelRead<span class="token punctuation">(</span>DefaultChannelPipeline.java:1410<span class="token punctuation">)</span>
        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead<span class="token punctuation">(</span>AbstractChannelHandlerContext.java:379<span class="token punctuation">)</span>
        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead<span class="token punctuation">(</span>AbstractChannelHandlerContext.java:365<span class="token punctuation">)</span>
        at io.netty.channel.DefaultChannelPipeline.fireChannelRead<span class="token punctuation">(</span>DefaultChannelPipeline.java:919<span class="token punctuation">)</span>
        at io.netty.channel.epoll.AbstractEpollStreamChannel<span class="token variable">$EpollStreamUnsafe</span>.epollInReady<span class="token punctuation">(</span>AbstractEpollStreamChannel.java:795<span class="token punctuation">)</span>
        at io.netty.channel.epoll.EpollEventLoop.processReady<span class="token punctuation">(</span>EpollEventLoop.java:480<span class="token punctuation">)</span>
        at io.netty.channel.epoll.EpollEventLoop.run<span class="token punctuation">(</span>EpollEventLoop.java:378<span class="token punctuation">)</span>
        at io.netty.util.concurrent.SingleThreadEventExecutor<span class="token variable">$4</span>.run<span class="token punctuation">(</span>SingleThreadEventExecutor.java:986<span class="token punctuation">)</span>
        at io.netty.util.internal.ThreadExecutorMap<span class="token variable">$2</span>.run<span class="token punctuation">(</span>ThreadExecutorMap.java:74<span class="token punctuation">)</span>
        at io.netty.util.concurrent.FastThreadLocalRunnable.run<span class="token punctuation">(</span>FastThreadLocalRunnable.java:30<span class="token punctuation">)</span>
        at java.base/java.lang.Thread.run<span class="token punctuation">(</span>Thread.java:829<span class="token punctuation">)</span>
Caused by: io.netty.handler.ssl.NotSslRecordException: not an SSL/TLS record: 485454502f312e31203430302042616420526571756573740d0a436f6e74656e742d4c656e6774683a20300d0a436f6e6e656374696f6e3a20636c6f73650d0a0d0a
        at io.netty.handler.ssl.SslHandler.decodeJdkCompatible<span class="token punctuation">(</span>SslHandler.java:1214<span class="token punctuation">)</span>
        Suppressed: reactor.core.publisher.FluxOnAssembly<span class="token variable">$OnAssemblyException</span><span class="token builtin class-name">:</span> 
Error has been observed at the following site<span class="token punctuation">(</span>s<span class="token punctuation">)</span>:
        *__checkpoint ⇢ top.tangyh.lypqs.gateway.filter.AccessLogFilter <span class="token punctuation">[</span>DefaultWebFilterChain<span class="token punctuation">]</span>
        *__checkpoint ⇢ org.springframework.cloud.gateway.filter.WeightCalculatorWebFilter <span class="token punctuation">[</span>DefaultWebFilterChain<span class="token punctuation">]</span>
        *__checkpoint ⇢ com.alibaba.csp.sentinel.adapter.spring.webflux.SentinelWebFluxFilter <span class="token punctuation">[</span>DefaultWebFilterChain<span class="token punctuation">]</span>
        *__checkpoint ⇢ top.tangyh.lypqs.gateway.filter.TokenContextFilter <span class="token punctuation">[</span>DefaultWebFilterChain<span class="token punctuation">]</span>
        *__checkpoint ⇢ top.tangyh.lypqs.gateway.filter.ContextPathFilter <span class="token punctuation">[</span>DefaultWebFilterChain<span class="token punctuation">]</span>
        *__checkpoint ⇢ org.springframework.boot.actuate.metrics.web.reactive.server.MetricsWebFilter <span class="token punctuation">[</span>DefaultWebFilterChain<span class="token punctuation">]</span>
        *__checkpoint ⇢ top.tangyh.lypqs.gateway.config.CorsConfiguration<span class="token variable">$$</span>Lambda<span class="token variable">$811</span>/0x00000008408ebc40 <span class="token punctuation">[</span>DefaultWebFilterChain<span class="token punctuation">]</span>
        *__checkpoint ⇢ top.tangyh.lypqs.gateway.filter.TraceFilter <span class="token punctuation">[</span>DefaultWebFilterChain<span class="token punctuation">]</span>
        *__checkpoint ⇢ HTTP GET <span class="token string">&quot;/api/oauth/resource/visible?ts=1747227403065&amp;resourceType=ADMIN_RESOURCE&amp;changeHttpsToHttp=false&quot;</span> <span class="token punctuation">[</span>ExceptionHandlingWebHandler<span class="token punctuation">]</span>
Original Stack Trace:
                at io.netty.handler.ssl.SslHandler.decodeJdkCompatible<span class="token punctuation">(</span>SslHandler.java:1214<span class="token punctuation">)</span>
                at io.netty.handler.ssl.SslHandler.decode<span class="token punctuation">(</span>SslHandler.java:1284<span class="token punctuation">)</span>
                at io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection<span class="token punctuation">(</span>ByteToMessageDecoder.java:507<span class="token punctuation">)</span>
                at io.netty.handler.codec.ByteToMessageDecoder.callDecode<span class="token punctuation">(</span>ByteToMessageDecoder.java:446<span class="token punctuation">)</span>
                at io.netty.handler.codec.ByteToMessageDecoder.channelRead<span class="token punctuation">(</span>ByteToMessageDecoder.java:276<span class="token punctuation">)</span>
                at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead<span class="token punctuation">(</span>AbstractChannelHandlerContext.java:379<span class="token punctuation">)</span>
                at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead<span class="token punctuation">(</span>AbstractChannelHandlerContext.java:365<span class="token punctuation">)</span>
                at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead<span class="token punctuation">(</span>AbstractChannelHandlerContext.java:357<span class="token punctuation">)</span>
                at io.netty.channel.DefaultChannelPipeline<span class="token variable">$HeadContext</span>.channelRead<span class="token punctuation">(</span>DefaultChannelPipeline.java:1410<span class="token punctuation">)</span>
                at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead<span class="token punctuation">(</span>AbstractChannelHandlerContext.java:379<span class="token punctuation">)</span>
                at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead<span class="token punctuation">(</span>AbstractChannelHandlerContext.java:365<span class="token punctuation">)</span>
                at io.netty.channel.DefaultChannelPipeline.fireChannelRead<span class="token punctuation">(</span>DefaultChannelPipeline.java:919<span class="token punctuation">)</span>
                at io.netty.channel.epoll.AbstractEpollStreamChannel<span class="token variable">$EpollStreamUnsafe</span>.epollInReady<span class="token punctuation">(</span>AbstractEpollStreamChannel.java:795<span class="token punctuation">)</span>
                at io.netty.channel.epoll.EpollEventLoop.processReady<span class="token punctuation">(</span>EpollEventLoop.java:480<span class="token punctuation">)</span>
                at io.netty.channel.epoll.EpollEventLoop.run<span class="token punctuation">(</span>EpollEventLoop.java:378<span class="token punctuation">)</span>
                at io.netty.util.concurrent.SingleThreadEventExecutor<span class="token variable">$4</span>.run<span class="token punctuation">(</span>SingleThreadEventExecutor.java:986<span class="token punctuation">)</span>
                at io.netty.util.internal.ThreadExecutorMap<span class="token variable">$2</span>.run<span class="token punctuation">(</span>ThreadExecutorMap.java:74<span class="token punctuation">)</span>
                at io.netty.util.concurrent.FastThreadLocalRunnable.run<span class="token punctuation">(</span>FastThreadLocalRunnable.java:30<span class="token punctuation">)</span>
                at java.base/java.lang.Thread.run<span class="token punctuation">(</span>Thread.java:829<span class="token punctuation">)</span>

<span class="token punctuation">[</span>lypqs-gateway-server:8080:0000:1<span class="token punctuation">]</span> <span class="token number">2025</span>-05-18 <span class="token number">21</span>:33:41.201<span class="token punctuation">[</span>TRACE<span class="token punctuation">]</span> <span class="token number">1</span> <span class="token punctuation">[</span>711e1083010c4aeb9991b6ba60f174d2<span class="token punctuation">]</span> <span class="token punctuation">[</span>reactor-http-epoll-3:6022343<span class="token punctuation">]</span> <span class="token punctuation">[</span>reactor.netty.channel.ChannelOperations.?:?<span class="token punctuation">]</span> <span class="token punctuation">[</span>11dd715f, L:/10.42.0.56:8080 - R:/10.42.0.1:54128<span class="token punctuation">]</span> Disposing ChannelOperation from a channel

java.lang.Exception: ChannelOperation terminal stack
        at reactor.netty.channel.ChannelOperations.terminate<span class="token punctuation">(</span>ChannelOperations.java:465<span class="token punctuation">)</span>
        at io.netty.util.concurrent.AbstractEventExecutor.safeExecute<span class="token punctuation">(</span>AbstractEventExecutor.java:164<span class="token punctuation">)</span>
        at io.netty.util.concurrent.SingleThreadEventExecutor.runAllTasks<span class="token punctuation">(</span>SingleThreadEventExecutor.java:469<span class="token punctuation">)</span>
        at io.netty.channel.epoll.EpollEventLoop.run<span class="token punctuation">(</span>EpollEventLoop.java:384<span class="token punctuation">)</span>
        at io.netty.util.concurrent.SingleThreadEventExecutor<span class="token variable">$4</span>.run<span class="token punctuation">(</span>SingleThreadEventExecutor.java:986<span class="token punctuation">)</span>
        at io.netty.util.internal.ThreadExecutorMap<span class="token variable">$2</span>.run<span class="token punctuation">(</span>ThreadExecutorMap.java:74<span class="token punctuation">)</span>
        at io.netty.util.concurrent.FastThreadLocalRunnable.run<span class="token punctuation">(</span>FastThreadLocalRunnable.java:30<span class="token punctuation">)</span>
        at java.base/java.lang.Thread.run<span class="token punctuation">(</span>Thread.java:829<span class="token punctuation">)</span>

<span class="token punctuation">[</span>lypqs-gateway-server:8080:0000:1<span class="token punctuation">]</span> <span class="token number">2025</span>-05-18 <span class="token number">21</span>:33:41.201<span class="token punctuation">[</span>DEBUG<span class="token punctuation">]</span> <span class="token number">1</span> <span class="token punctuation">[</span>711e1083010c4aeb9991b6ba60f174d2<span class="token punctuation">]</span> <span class="token punctuation">[</span>reactor-http-epoll-3:6022343<span class="token punctuation">]</span> <span class="token punctuation">[</span>r.netty.resources.DefaultPooledConnectionProvider.?:?<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token number">73863284</span>, L:/10.42.0.56:59796 <span class="token operator">!</span> R:10.42.0.50/10.42.0.50:8080<span class="token punctuation">]</span> onStateChange<span class="token punctuation">(</span>PooledConnection<span class="token punctuation">{</span>channel<span class="token operator">=</span><span class="token punctuation">[</span>id: 0x73863284, L:/10.42.0.56:59796 <span class="token operator">!</span> R:10.42.0.50/10.42.0.50:8080<span class="token punctuation">]</span><span class="token punctuation">}</span>, <span class="token punctuation">[</span>disconnecting<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="排查过程" tabindex="-1"><a class="header-anchor" href="#排查过程" aria-hidden="true">#</a> 排查过程</h2><p>此处省略10000字，如果真的把整个过程写下来的，估计10000字都不够。</p><p>中途通过gateway 端口的入站请求包，发现是http请求，但日志里或者通过exchange.getRequest().getURI().getSchema()却返回https</p><p>和这个头有关：X-Forwarded-Proto: https</p><h2 id="罪魁祸首" tabindex="-1"><a class="header-anchor" href="#罪魁祸首" aria-hidden="true">#</a> 罪魁祸首</h2><p>配置： <code>server.forward-headers-strategy</code></p><p>由于配置文件中其实没有配置这个的参数的，所以导致了不同部署环境有不同的表现。</p><p>然后也正式因为没有配置这个参数，到最后定位到这个参数也是相当坎坷。</p><p>我们底层采用的事Undertow，undertow在没有配置这个参数的情况下不同的部署环境有不同的行为：</p><figure><img src="https://cdn.justdopay.top/notion/md5-2edd5042140fd6228767403250f79f3f.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><figure><img src="https://cdn.justdopay.top/notion/md5-5f8b74f2a3d6273e4da89a738ae38376.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><p>具体就请各位自己看代码了。</p><p>再我的这个情况下需要设置为 none . 尝试过fremework也不行</p><br><h2 id="系统推荐" tabindex="-1"><a class="header-anchor" href="#系统推荐" aria-hidden="true">#</a> 系统推荐</h2>`,16),f=n("p",null,[n("br"),n("br"),n("br"),n("br"),n("br"),n("br")],-1),C=n("hr",null,null,-1),x=n("hr",null,null,-1),_=n("ul",null,[n("li",null,[n("strong",null,"随机毒鸡汤"),a("：强者惜字如金，弱者废话连篇。 "),n("br"),n("br"),n("img",{src:"https://images.pexels.com/photos/32096259/pexels-photo-32096259.jpeg?auto=compress&cs=tinysrgb&h=650&w=940",alt:"",loading:"lazy"})])],-1);function w(A,R){const p=o("ExternalLinkIcon"),t=o("RouterLink");return i(),u("div",null,[d,n("p",null,[n("a",k,[a("http://10.1.12.7:8760/api"),s(p)]),a(" 指向的是一个spring cloud gateway服务，这个gateway是用docker-compose部署的，采用的镜像比如是："),n("a",v,[a("a.com/gateway:1.0，部署的服务器内网ip是：10.1.12.7"),s(p)])]),n("p",null,[a("然后有一天我再同样的服务器上用同样版本的镜像："),n("a",b,[a("a.com/gateway:1.0，通过k3s部署了一下，然后通过service暴露到节点上，节点端口是31760，那么访问地址就是："),s(p)]),n("a",m,[a("http://10.1.12.7:31760/api"),s(p)])]),n("p",null,[a("然后把上面的"),n("a",h,[a("http://10.1.12.7:8760/api"),s(p)]),a(" 改为 "),n("a",g,[a("http://10.1.12.7:31760/api"),s(p)]),a(" ，也就是指向了通过k3s部署的那个gateway服务。")]),n("p",null,[a("然后通过"),n("a",y,[a("https://xxxxx.top/api/xxxxx进行访问，奇怪的事情发生了，会出现这样的异常信息："),s(p)])]),E,n("ul",null,[n("li",null,[s(t,{to:"/software/middleware/redis/Redis%E7%AC%94%E8%AE%B0.html"},{default:e(()=>[a("Redis笔记")]),_:1})]),n("li",null,[s(t,{to:"/software/jvm/JVM%E5%8F%82%E6%95%B0%E8%AE%BE%E7%BD%AE.html"},{default:e(()=>[a("JVM参数设置")]),_:1})]),n("li",null,[s(t,{to:"/other/%E6%89%8B%E6%8A%8A%E6%89%8B%E6%95%99%E4%BD%A0%E5%88%B6%E4%BD%9CCookie%E3%80%81Local%E3%80%81Session%E6%95%B0%E6%8D%AE%E5%AF%BC%E5%87%BA%E6%8F%92%E4%BB%B6.html"},{default:e(()=>[a("手把手教你制作Cookie、Local、Session数据导出插件")]),_:1})]),n("li",null,[s(t,{to:"/software/shodowsocks/ShadowsockServer.html"},{default:e(()=>[a("ShadowsockServer")]),_:1})]),n("li",null,[s(t,{to:"/software/java-basic/IO%E7%9B%B8%E5%85%B3.html"},{default:e(()=>[a("IO相关")]),_:1})]),n("li",null,[s(t,{to:"/other/%E9%AB%98%E5%8F%AF%E7%94%A8%E9%80%9A%E7%94%A8%E6%96%B9%E6%A1%88.html"},{default:e(()=>[a("高可用通用方案")]),_:1})]),n("li",null,[s(t,{to:"/other/Spring%20Boot%E5%8D%87%E7%BA%A7%E5%88%B02%206%20x%E8%B8%A9%E7%9A%84%E5%9D%91.html"},{default:e(()=>[a("Spring Boot升级到2 6 x踩的坑")]),_:1})]),n("li",null,[s(t,{to:"/software/unclassified/%E7%AE%80%E6%98%93%E7%89%88%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83&%E5%88%9D%E6%8E%A2%E5%8E%9F%E7%90%86.html"},{default:e(()=>[a("简易版配置中心&初探原理")]),_:1})]),n("li",null,[s(t,{to:"/software/java-basic/%E4%B8%8D%E9%87%8D%E5%90%AF%20JVM%EF%BC%8C%E5%A6%82%E4%BD%95%E6%9B%BF%E6%8D%A2%E6%8E%89%E5%B7%B2%E7%BB%8F%E5%8A%A0%E8%BD%BD%E7%9A%84%E7%B1%BB%EF%BC%9F.html"},{default:e(()=>[a("不重启 JVM，如何替换掉已经加载的类？")]),_:1})]),n("li",null,[s(t,{to:"/software/middleware/mysql/MySQL%E4%B8%89%E5%A4%A7%E6%97%A5%E5%BF%97.html"},{default:e(()=>[a("MySQL三大日志")]),_:1})]),n("li",null,[s(t,{to:"/other/vuepress/vuepress-theme-hope%E4%BD%BF%E7%94%A8%E5%BF%83%E5%BE%97.html"},{default:e(()=>[a("vuepress-theme-hope使用心得")]),_:1})]),n("li",null,[s(t,{to:"/other/PostgreSQL%E9%AB%98%E5%8F%AF%E7%94%A8.html"},{default:e(()=>[a("PostgreSQL高可用")]),_:1})])]),f,C,x,_])}const B=l(r,[["render",w],["__file","Spring Cloud Gateway收到的是http请求，但schema却是https.html.vue"]]);export{B as default};
