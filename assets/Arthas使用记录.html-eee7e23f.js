import{_ as r,$ as c,a0 as d,a1 as a,a2 as n,a3 as e,a4 as t,a5 as o,w as i}from"./framework-b3a0f150.js";const p={},u=o(`<p>思考如下问题：</p><ol><li>现在有个接口在开发环境非常快，但线上环境就是慢（假设已经知道了就是代码问题，如何定位具体问题）</li><li>我明明改了代码了，为啥子测试环境感觉没生效？ 运维又说更新了代码了，怎么如何确认</li><li>排查问题的时候，想知道某个方法的入参、出参，但是代码里又买有打印相关日志，怎么搞？</li><li>让运维修改了某个配置的值，但运维部署后，始终感觉有问题，感觉没有更改一样，又没有相关日志，怎么确认？</li></ol><h2 id="vmtool" tabindex="-1"><a class="header-anchor" href="#vmtool" aria-hidden="true">#</a> vmtool</h2><p>这个命令可以获取指定类的实例对象，拿到实例对象后还能执行实例方法等。通过help查看使用方法</p><figure><img src="https://cdn.justdopay.top/notion/md5-4112d9049c217b8cd9ee1dc3457a7f4d.png" alt="Untitled" tabindex="0" loading="lazy"><figcaption>Untitled</figcaption></figure><p>通过这个命令可以拿到指定类的实例，并执行实例的方法，查看字段值等。</p><h3 id="调用方法时创建对象" tabindex="-1"><a class="header-anchor" href="#调用方法时创建对象" aria-hidden="true">#</a> 调用方法时创建对象</h3><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code>private Object getXXX(Long p1<span class="token punctuation">,</span>List p2<span class="token punctuation">,</span>Set p3);

可以像下面这样创建对象并调用
vmtool --action getInstances --className com.xxx.XXX --express &#39;instances<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>.getXXX(1L<span class="token punctuation">,</span>(#test1=new java.util.ArrayList()<span class="token punctuation">,</span>#test1.add(<span class="token string">&quot;test&quot;</span>)<span class="token punctuation">,</span>#test1)<span class="token punctuation">,</span>(#test=new java.util.HashSet()<span class="token punctuation">,</span>#test.add(<span class="token string">&quot;&quot;</span>)<span class="token punctuation">,</span>#test))&#39;

如果执行vmtool提示类不存在，然后sc却能搜索到类，那么可以加上-c参数来指定类加载器。类加载器可以通过sc -d 类名来获得，例如：

vmtool --action getInstances -c 21b8d17c --className com.xxxxx.XXXXServiceClientImpl --express &#39;instances<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>.getCustomerList((#test1=new com.xxxxx.XXXXCustomerListReq()<span class="token punctuation">,</span>#test1.setCreatedAtStart(<span class="token number">1717224477</span>)<span class="token punctuation">,</span>#test1.setCreatedAtEnd(<span class="token number">1719816477</span>)<span class="token punctuation">,</span>#test1.setPageNo(<span class="token number">1</span>)<span class="token punctuation">,</span>#test1.setPageSize(<span class="token number">100</span>)<span class="token punctuation">,</span>#test1)<span class="token punctuation">,</span><span class="token string">&quot;123456&quot;</span>)&#39;

vmtool 条件过滤
trace com.xxxx.XXXXServiceImpl getXXXXConfig  -n <span class="token number">5</span> --skipJDKMethod <span class="token boolean">false</span> &#39;<span class="token string">&quot;20111984&quot;</span>.equalsIgnoreCase(params<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>)&#39;

比较复杂的调用例子
vmtool -c xxxx -x <span class="token number">3</span> --action getInstances --className xxxx.TbProMemberClient  --express &#39;instances<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>.taobaoClient(<span class="token string">&quot;xxxxx&quot;</span>).execute((#p=@com.alibaba.fastjson.JSON@parseObject(<span class="token string">&quot;{\\&quot;ouid\\&quot;:\\&quot;ouid\\&quot;,\\&quot;omid\\&quot;:\\&quot;omid\\&quot;}&quot;</span><span class="token punctuation">,</span>@com.taobao.api.request.TmallOpencrmMemberPremiumRefundRequest@class)<span class="token punctuation">,</span>#p)<span class="token punctuation">,</span><span class="token string">&quot;xxxx&quot;</span>)&#39; 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ognl" tabindex="-1"><a class="header-anchor" href="#ognl" aria-hidden="true">#</a> ognl</h2><h3 id="获取静态属性值" tabindex="-1"><a class="header-anchor" href="#获取静态属性值" aria-hidden="true">#</a> 获取静态属性值</h3><ul><li>格式： ognl -x 2 ‘@类名@静态属性名’</li></ul><div class="language-jsx line-numbers-mode" data-ext="jsx"><pre class="language-jsx"><code>ognl <span class="token operator">-</span>x <span class="token number">1</span> <span class="token string">&#39;@com.xxxx.SpringUtils@applicationContext&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>很有可能出现下面的错误</p><figure><img src="https://cdn.justdopay.top/notion/md5-23d32f676a1fea41242ba0cdf36621a9.png" alt="Untitled" tabindex="0" loading="lazy"><figcaption>Untitled</figcaption></figure><p>就是提示找不到这个类。这个时候需要先找到加载这个类的classloader（sc -d 类名）</p><p>再执行下面的命令：</p><div class="language-jsx line-numbers-mode" data-ext="jsx"><pre class="language-jsx"><code>ognl <span class="token operator">-</span>x <span class="token number">1</span> <span class="token operator">-</span>c <span class="token string">&#39;@com.xxxx.SpringUtils@applicationContext&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://cdn.justdopay.top/notion/md5-b204ab9cd53ca1bc1265e4d2af50900f.png" alt="Untitled" tabindex="0" loading="lazy"><figcaption>Untitled</figcaption></figure><h3 id="获取普通属性值" tabindex="-1"><a class="header-anchor" href="#获取普通属性值" aria-hidden="true">#</a> 获取普通属性值</h3><div class="language-jsx line-numbers-mode" data-ext="jsx"><pre class="language-jsx"><code>ognl <span class="token operator">-</span>x <span class="token number">3</span> <span class="token string">&#39;#springContext=@com.xxxxx.SpringUtils@applicationContext,#springContext.getBean(&quot;xxxxServiceImpl&quot;).schema&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="调用静态方法" tabindex="-1"><a class="header-anchor" href="#调用静态方法" aria-hidden="true">#</a> 调用静态方法</h3><p>和静态属性很相似</p><div class="language-jsx line-numbers-mode" data-ext="jsx"><pre class="language-jsx"><code>ognl <span class="token operator">-</span>x <span class="token number">3</span> <span class="token string">&#39;@com.xxxx.SpringUtils@getBean(&quot;xxxxServiceImpl&quot;)&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="调用实例方法" tabindex="-1"><a class="header-anchor" href="#调用实例方法" aria-hidden="true">#</a> 调用实例方法</h3><div class="language-jsx line-numbers-mode" data-ext="jsx"><pre class="language-jsx"><code>ognl <span class="token operator">-</span>x <span class="token number">3</span> <span class="token string">&#39;#springContext=@com.xxxx.SpringUtils@applicationContext,#springContext.getBean(&quot;xxxxServiceImpl&quot;)&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="ognl扩展阅读" tabindex="-1"><a class="header-anchor" href="#ognl扩展阅读" aria-hidden="true">#</a> ognl扩展阅读</h3>`,26),m={href:"https://commons.apache.org/proper/commons-ognl/language-guide.html",target:"_blank",rel:"noopener noreferrer"},h=o(`<h2 id="watch" tabindex="-1"><a class="header-anchor" href="#watch" aria-hidden="true">#</a> Watch</h2><ul><li>方法调用层级比较多，有问题需要排查，但又没有日志，需要查看某个中间结果的。比如想看calcCrons这个方法的返回是是什么</li></ul><figure><img src="https://cdn.justdopay.top/notion/md5-256041297aa45aa490eb6b0db3b27917.png" alt="Untitled" tabindex="0" loading="lazy"><figcaption>Untitled</figcaption></figure><ul><li>比如某个方法执行异常了，但是日志中没有打印堆栈信息，这个时候就能快速定位异常位置</li></ul><h2 id="trace" tabindex="-1"><a class="header-anchor" href="#trace" aria-hidden="true">#</a> Trace</h2><p>主要是查看某个方法内部各个节点的耗时情况</p><h3 id="案例一" tabindex="-1"><a class="header-anchor" href="#案例一" aria-hidden="true">#</a> 案例一</h3><p>之前前端同事说下面的接口比较慢</p><p><code>/xxxx/xxxx/xxxx/xxxx/list</code></p><figure><img src="https://cdn.justdopay.top/notion/md5-275c78fc16854272237bb5132af5bb47.png" alt="Untitled" tabindex="0" loading="lazy"><figcaption>Untitled</figcaption></figure><h3 id="案例二" tabindex="-1"><a class="header-anchor" href="#案例二" aria-hidden="true">#</a> 案例二</h3><p>之前遇到过<code>SecureRandom.getInstanceStrong()</code> 的next这个方法在windows和docker环境中都能正常响应，但在centos（没有采用docker）中就很慢，甚至超时。</p><p>百度搜索：SecureRandom.getInstanceStrong() 就知道具体原因</p><h2 id="常用命令" tabindex="-1"><a class="header-anchor" href="#常用命令" aria-hidden="true">#</a> 常用命令</h2><h3 id="一键离线安装" tabindex="-1"><a class="header-anchor" href="#一键离线安装" aria-hidden="true">#</a> 一键离线安装</h3><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code>mkdir -p /tmp/arthas
wget https<span class="token operator">:</span><span class="token comment">//arthas.aliyun.com/download/latest_version?mirror=aliyun -O /tmp/arthas/arthas.zip</span>
unzip /tmp/arthas/arthas.zip -d /tmp/arthas/
java -jar /tmp/arthas/arthas-boot.jar
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="查看启用端口" tabindex="-1"><a class="header-anchor" href="#查看启用端口" aria-hidden="true">#</a> 查看启用端口</h3><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code>vmtool --action getInstances --className org.springframework.context.ConfigurableApplicationContext --express &#39;instances<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>.getEnvironment().getProperty(<span class="token string">&quot;server.port&quot;</span>)&#39;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="查看数据库连接" tabindex="-1"><a class="header-anchor" href="#查看数据库连接" aria-hidden="true">#</a> 查看数据库连接</h3><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code>vmtool --action getInstances --className com.alibaba.druid.spring.boot.autoconfigure.DruidDataSourceWrapper --express &#39;instances<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>.basicProperties&#39;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="查看contextpath" tabindex="-1"><a class="header-anchor" href="#查看contextpath" aria-hidden="true">#</a> 查看contextPath</h3><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code>vmtool --action getInstances --className org.springframework.context.ConfigurableApplicationContext --express &#39;instances<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>.getEnvironment().getProperty(<span class="token string">&quot;server.context-path&quot;</span>)&#39;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><br><h2 id="系统推荐" tabindex="-1"><a class="header-anchor" href="#系统推荐" aria-hidden="true">#</a> 系统推荐</h2>`,24),x=a("p",null,[a("br"),a("br"),a("br"),a("br"),a("br"),a("br")],-1),g=a("hr",null,null,-1),b=a("hr",null,null,-1),v=a("ul",null,[a("li",null,[a("strong",null,"随机毒鸡汤"),n("：今天心情不好删几个微商，让他们知道，创业的道路并不是一帆风顺。 "),a("br"),a("br"),a("img",{src:"https://images.pexels.com/photos/6953777/pexels-photo-6953777.jpeg?auto=compress&cs=tinysrgb&h=650&w=940",alt:"A candid moment of two women chatting during a podcast recording session.",loading:"lazy"})])],-1);function k(f,E){const l=i("ExternalLinkIcon"),s=i("RouterLink");return c(),d("div",null,[u,a("p",null,[a("a",m,[n("https://commons.apache.org/proper/commons-ognl/language-guide.html"),e(l)])]),h,a("ul",null,[a("li",null,[e(s,{to:"/other/HTTP1%200%20vs%20HTTP1%201%20vs%20WebSocket.html"},{default:t(()=>[n("HTTP1 0 vs HTTP1 1 vs WebSocket")]),_:1})]),a("li",null,[e(s,{to:"/other/MongoDB%E9%AB%98%E5%8F%AF%E7%94%A8.html"},{default:t(()=>[n("MongoDB高可用")]),_:1})]),a("li",null,[e(s,{to:"/software/unclassified/KVM%E6%96%B9%E5%BC%8F%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2ES.html"},{default:t(()=>[n("KVM方式集群部署ES")]),_:1})]),a("li",null,[e(s,{to:"/software/unclassified/%E4%B9%B1%E4%B8%83%E5%85%AB%E7%B3%9F%E7%9A%84%E7%AC%94%E8%AE%B0.html"},{default:t(()=>[n("乱七八糟的笔记")]),_:1})]),a("li",null,[e(s,{to:"/software/middleware/mq/kafka.html"},{default:t(()=>[n("kafka")]),_:1})]),a("li",null,[e(s,{to:"/other/Spring%20RetryTemplate.html"},{default:t(()=>[n("Spring RetryTemplate")]),_:1})]),a("li",null,[e(s,{to:"/other/istio%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.html"},{default:t(()=>[n("istio基础知识")]),_:1})]),a("li",null,[e(s,{to:"/software/unclassified/%E6%89%B9%E9%87%8F%E4%BF%AE%E6%94%B9git%E5%8E%86%E5%8F%B2%E8%AE%B0%E5%BD%95%E4%B8%AD%E7%9A%84%E7%94%A8%E6%88%B7%E5%90%8D%E5%92%8C%E9%82%AE%E7%AE%B1.html"},{default:t(()=>[n("批量修改git历史记录中的用户名和邮箱")]),_:1})]),a("li",null,[e(s,{to:"/other/%E6%8E%A8%E8%8D%90%E5%87%A0%E4%B8%AA%E9%80%82%E7%94%A8%E5%B0%8F%E5%B7%A5%E5%85%B7.html"},{default:t(()=>[n("推荐几个适用小工具")]),_:1})]),a("li",null,[e(s,{to:"/software/middleware/mysql/MySQL%E4%B8%89%E5%A4%A7%E6%97%A5%E5%BF%97.html"},{default:t(()=>[n("MySQL三大日志")]),_:1})]),a("li",null,[e(s,{to:"/other/Lombok%E7%9A%84Accessors%E5%AF%BC%E8%87%B4EasyExcel%E8%AF%BB%E5%8F%96%E5%A4%B1%E8%B4%A5.html"},{default:t(()=>[n("Lombok的Accessors导致EasyExcel读取失败")]),_:1})]),a("li",null,[e(s,{to:"/software/java-basic/Java%E9%9D%A2%E8%AF%95%E5%9F%BA%E7%A1%80.html"},{default:t(()=>[n("Java面试基础")]),_:1})])]),x,g,b,v])}const _=r(p,[["render",k],["__file","Arthas使用记录.html.vue"]]);export{_ as default};
