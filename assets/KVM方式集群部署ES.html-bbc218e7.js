import{_ as i,$ as l,a0 as p,a1 as a,a3 as n,a4 as e,a5 as o,a2 as s,w as r}from"./framework-8c4427da.js";const c={},d=o(`<h2 id="步骤" tabindex="-1"><a class="header-anchor" href="#步骤" aria-hidden="true">#</a> 步骤</h2><p>本文档模拟的是把kvm镜像拷贝到新机子上进行部署的过程。</p><p>由于多台机子和单台机子上进行部署的过程很类似，所以这里只描述部署一台机子的过程。</p><ol><li><p>一台主机（需要提前安装好kvm）</p></li><li><p>kvm的镜像 （可从192.168.1.99:/kvmimg目录下载）</p></li></ol><figure><img src="https://cdn.justdopay.top/xiaoshujiang/1629084557911.png" alt="enter description here" tabindex="0" loading="lazy"><figcaption>enter description here</figcaption></figure><hr><ol><li><p>把下载的两个文件 es-172.26.43.130.img es-172.26.43.130.xml 上传到主机的某个目录下。 比如（/opt/kvmimg）</p></li><li><p>查看主机的cpu model : virsh capabilities <img src="https://cdn.justdopay.top/xiaoshujiang/1629084574573.png" alt="enter description here" loading="lazy"></p></li><li><p>编辑上传的xml文件，找到cpu相关的xml配置，并修改model为刚才查到的model。 <img src="https://cdn.justdopay.top/xiaoshujiang/1629084589638.png" alt="enter description here" loading="lazy"></p></li></ol><p>上图中的name uuid memory 可自行根据实际情况修改。</p><ol start="4"><li><p>继续修改xml，找到 “es-172.26.43.130.img” 字样的位置，并修改路径为正确的路径。 <img src="https://cdn.justdopay.top/xiaoshujiang/1629084636546.png" alt="enter description here" loading="lazy"></p></li><li><p>执行：virsh define 上传的xml文件路径 <img src="https://cdn.justdopay.top/xiaoshujiang/1629084653784.png" alt="enter description here" loading="lazy"> .</p></li><li><p>执行： virsh start xml文件中的name （可能会有意外情况，请参考下方的 <strong>意外情况</strong>） <img src="https://cdn.justdopay.top/xiaoshujiang/1629084701285.png" alt="enter description here" loading="lazy"></p></li><li><p>执行：virsh console xml文件中的name 进入虚拟机 （root / Admin@9000）</p></li><li><p>修改网络文件获取ip （/etc/sysconfig/network-scripts/ifcfg-eth0）</p></li><li><p>修改es的配置文件为正确的配置 （es的存放目录在 /programs/elasticsearch-7.4.1 ）</p><ul><li><strong>注意</strong>：数据存放和日志存放目录需要 elastic 用户能方法 。 elastic 用户已经默认创建好了</li></ul></li><li><p>启动es (bin/elasticsearch -d)</p></li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">su</span> elastic
<span class="token builtin class-name">cd</span> /programs/elasticsearch-7.4.1
bin/elasticsearch <span class="token parameter variable">-d</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="11"><li>还需要启动nfs</li></ol><h2 id="意外情况" tabindex="-1"><a class="header-anchor" href="#意外情况" aria-hidden="true">#</a> 意外情况</h2><p>上面在执行virsh start xxx 的时候可能会出现下面的几个错。</p><ol><li><p>the cpu is incompatible with host cpu: 主机不提供所需功能：md-clear ssbd - 修改xml直接删除xml文件中的cpu的相关配置信息即可 （应该刚才已经执行了 virsh define 命令，所以这里的修改使用 <strong>virsh edit 虚拟机名字</strong> 来修改）</p></li><li><p>the cput is incompatible with host cpu: 主机不提供所需功能：spec-ctrl .</p><ul><li>这个问题应该就是xml文件中cpu的model不对，请重新检查 上面的2、3两个步骤</li></ul></li></ol><h2 id="虚拟机磁盘扩容" tabindex="-1"><a class="header-anchor" href="#虚拟机磁盘扩容" aria-hidden="true">#</a> 虚拟机磁盘扩容</h2><p>默认情况下上诉步骤跑起来的虚拟机只有10g的磁盘空间。所以需要扩容。 <img src="https://cdn.justdopay.top/xiaoshujiang/1629084721547.png" alt="enter description here" loading="lazy"></p><p>扩容的两种方式：</p><ul><li><p>直接扩容原来的img文件（是一个虚拟硬盘）</p></li><li><p>创建新的img文件然后挂载上去（相当于挂载一个新磁盘）</p></li></ul><h3 id="直接扩容原有img文件" tabindex="-1"><a class="header-anchor" href="#直接扩容原有img文件" aria-hidden="true">#</a> 直接扩容原有img文件</h3><ol><li><p>退出虚拟机进入宿主机，然后执行 <img src="https://cdn.justdopay.top/xiaoshujiang/1629084741406.png" alt="enter description here" loading="lazy"></p></li><li><p>进入虚拟机: virsh console xxxxx 可以看到硬盘容量增加了100G <img src="https://cdn.justdopay.top/xiaoshujiang/1629084754196.png" alt="enter description here" loading="lazy"></p></li><li><p>但增加的容量现在不可用，需要执行： <img src="https://cdn.justdopay.top/xiaoshujiang/1629084776234.png" alt="enter description here" loading="lazy"></p></li><li><p>再看看： <img src="https://cdn.justdopay.top/xiaoshujiang/1629084797758.png" alt="enter description here" loading="lazy"></p></li><li><p>执行reboot，再次进入虚拟机 <img src="https://cdn.justdopay.top/xiaoshujiang/1629084814280.png" alt="enter description here" loading="lazy"></p></li><li><p>格式化新分区 <img src="https://cdn.justdopay.top/xiaoshujiang/1629084829503.png" alt="enter description here" loading="lazy"></p></li><li><p>挂载到某个目录 (这里挂载到 /opt 目录) <img src="https://cdn.justdopay.top/xiaoshujiang/1629084842375.png" alt="enter description here" loading="lazy"></p></li><li><p>修改 /etc/fstab 文件，让虚拟机重启后自动挂载 /dev/vda4分区到 /opt目录下 <img src="https://cdn.justdopay.top/xiaoshujiang/1629084855092.png" alt="enter description here" loading="lazy"></p></li><li><p>重启 reboot ,进入虚拟机，查看挂载情况 <img src="https://cdn.justdopay.top/xiaoshujiang/1629084918061.png" alt="enter description here" loading="lazy"></p></li></ol><h3 id="创建新的img文件然后挂载上去" tabindex="-1"><a class="header-anchor" href="#创建新的img文件然后挂载上去" aria-hidden="true">#</a> 创建新的img文件然后挂载上去</h3><p>这种方式相当于挂载了一个新的硬盘上去</p><ol><li><p>在宿主机创建虚拟硬盘文件 <img src="https://cdn.justdopay.top/xiaoshujiang/1629084943059.png" alt="enter description here" loading="lazy"> .</p></li><li><p>编辑虚拟机的xml文件 virsh edit xxxxx，找到disk相关配置，加入下面的配置：</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>disk</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&#39;</span>file<span class="token punctuation">&#39;</span></span> <span class="token attr-name">device</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&#39;</span>disk<span class="token punctuation">&#39;</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>driver</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&#39;</span>qemu<span class="token punctuation">&#39;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&#39;</span>qcow2<span class="token punctuation">&#39;</span></span><span class="token punctuation">/&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>source</span> <span class="token attr-name">file</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&#39;</span>/pqs/kvm/pqstest/test.img<span class="token punctuation">&#39;</span></span><span class="token punctuation">/&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>target</span> <span class="token attr-name">dev</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&#39;</span>hdf<span class="token punctuation">&#39;</span></span> <span class="token attr-name">bus</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&#39;</span>virtio<span class="token punctuation">&#39;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>disk</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://cdn.justdopay.top/xiaoshujiang/1629084961721.png" alt="enter description here" tabindex="0" loading="lazy"><figcaption>enter description here</figcaption></figure></li><li><p>重启虚拟机，进入虚拟机（好像可以不重启，可自行测试） <img src="https://cdn.justdopay.top/xiaoshujiang/1629084995461.png" alt="enter description here" loading="lazy"></p></li><li><p>查看硬盘情况，出现新的硬盘 <img src="https://cdn.justdopay.top/xiaoshujiang/1629085010430.png" alt="enter description here" loading="lazy"></p></li><li><p>对新硬盘分区（这里只分1个区，可自行决定分几个） <img src="https://cdn.justdopay.top/xiaoshujiang/1629085029363.png" alt="enter description here" loading="lazy"></p></li><li><p>查看硬盘情况，看到新分区 <img src="https://cdn.justdopay.top/xiaoshujiang/1629085054270.png" alt="enter description here" loading="lazy"></p></li><li><p>格式化并挂载新分区到目录下，这个步骤和上面的步骤一样了，不再赘述</p></li></ol><br><h2 id="系统推荐" tabindex="-1"><a class="header-anchor" href="#系统推荐" aria-hidden="true">#</a> 系统推荐</h2>`,25),u=a("p",null,[a("br"),a("br"),a("br"),a("br"),a("br"),a("br")],-1),h=a("hr",null,null,-1),g=a("hr",null,null,-1),m=a("ul",null,[a("li",null,[a("strong",null,"随机毒鸡汤"),s("：你坐过最挤的公交车是什么？只是路过，却被挤上了车。 "),a("br"),a("br"),a("img",{src:"https://images.pexels.com/photos/307008/pexels-photo-307008.jpeg?auto=compress&cs=tinysrgb&h=650&w=940",alt:"Man enjoys a scenic view of Es Vedrà at sunset from a cliff in San Juan Bautista, providing a perfect summer escape.",loading:"lazy"})])],-1);function k(E,x){const t=r("RouterLink");return l(),p("div",null,[d,a("ul",null,[a("li",null,[n(t,{to:"/software/unclassified/Oh%20My%20ZSH.html"},{default:e(()=>[s("Oh My ZSH")]),_:1})]),a("li",null,[n(t,{to:"/software/middleware/redis/Redis%E7%AC%94%E8%AE%B0.html"},{default:e(()=>[s("Redis笔记")]),_:1})]),a("li",null,[n(t,{to:"/software/unclassified/KVM%20%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85.html"},{default:e(()=>[s("KVM 虚拟机安装")]),_:1})]),a("li",null,[n(t,{to:"/other/HTTP1%200%20vs%20HTTP1%201%20vs%20WebSocket.html"},{default:e(()=>[s("HTTP1 0 vs HTTP1 1 vs WebSocket")]),_:1})]),a("li",null,[n(t,{to:"/other/Spring%20RetryTemplate.html"},{default:e(()=>[s("Spring RetryTemplate")]),_:1})]),a("li",null,[n(t,{to:"/software/unclassified/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%8C%B9%E9%85%8D%E7%AC%AC%E5%87%A0%E4%B8%AA%E7%AC%A6%E5%8F%B7%E9%97%AE%E9%A2%98.html"},{default:e(()=>[s("正则表达式匹配第几个符号问题")]),_:1})]),a("li",null,[n(t,{to:"/software/unclassified/index%E6%96%B9%E6%B3%95%E5%8E%8B%E5%8A%9B%E6%B5%8B%E8%AF%95%E8%AE%B0%E5%BD%95.html"},{default:e(()=>[s("index方法压力测试记录")]),_:1})]),a("li",null,[n(t,{to:"/software/middleware/mysql/InnoDB%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E.html"},{default:e(()=>[s("InnoDB存储引擎")]),_:1})]),a("li",null,[n(t,{to:"/software/middleware/mysql/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1Seata.html"},{default:e(()=>[s("分布式事务Seata")]),_:1})]),a("li",null,[n(t,{to:"/other/vuepress-theme-hope%20%E6%B7%BB%E5%8A%A0%E8%B0%B7%E6%AD%8C%E5%B9%BF%E5%91%8A.html"},{default:e(()=>[s("vuepress-theme-hope 添加谷歌广告")]),_:1})]),a("li",null,[n(t,{to:"/software/raft/raft%E5%8D%8F%E8%AE%AE.html"},{default:e(()=>[s("raft协议")]),_:1})]),a("li",null,[n(t,{to:"/other/%E9%9A%8F%E6%9C%BA%E5%9B%BE%E7%89%87%E5%9C%A8%E7%BA%BF%E6%8E%A5%E5%8F%A3.html"},{default:e(()=>[s("随机图片在线接口")]),_:1})])]),u,h,g,m])}const v=i(c,[["render",k],["__file","KVM方式集群部署ES.html.vue"]]);export{v as default};
