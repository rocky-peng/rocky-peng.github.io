import{_ as i,$ as l,a0 as p,a1 as a,a3 as t,a4 as e,a5 as o,a2 as n,w as c}from"./framework-b3a0f150.js";const r={},u=o(`<h2 id="步骤" tabindex="-1"><a class="header-anchor" href="#步骤" aria-hidden="true">#</a> 步骤</h2><p>本文档模拟的是把kvm镜像拷贝到新机子上进行部署的过程。</p><p>由于多台机子和单台机子上进行部署的过程很类似，所以这里只描述部署一台机子的过程。</p><ol><li><p>一台主机（需要提前安装好kvm）</p></li><li><p>kvm的镜像 （可从192.168.1.99:/kvmimg目录下载）</p></li></ol><figure><img src="https://cdn.justdopay.com/xiaoshujiang/1629084557911.png" alt="enter description here" tabindex="0" loading="lazy"><figcaption>enter description here</figcaption></figure><hr><ol><li><p>把下载的两个文件 es-172.26.43.130.img es-172.26.43.130.xml 上传到主机的某个目录下。 比如（/opt/kvmimg）</p></li><li><p>查看主机的cpu model : virsh capabilities <img src="https://cdn.justdopay.com/xiaoshujiang/1629084574573.png" alt="enter description here" loading="lazy"></p></li><li><p>编辑上传的xml文件，找到cpu相关的xml配置，并修改model为刚才查到的model。 <img src="https://cdn.justdopay.com/xiaoshujiang/1629084589638.png" alt="enter description here" loading="lazy"></p></li></ol><p>上图中的name uuid memory 可自行根据实际情况修改。</p><ol start="4"><li><p>继续修改xml，找到 “es-172.26.43.130.img” 字样的位置，并修改路径为正确的路径。 <img src="https://cdn.justdopay.com/xiaoshujiang/1629084636546.png" alt="enter description here" loading="lazy"></p></li><li><p>执行：virsh define 上传的xml文件路径 <img src="https://cdn.justdopay.com/xiaoshujiang/1629084653784.png" alt="enter description here" loading="lazy"> .</p></li><li><p>执行： virsh start xml文件中的name （可能会有意外情况，请参考下方的 <strong>意外情况</strong>） <img src="https://cdn.justdopay.com/xiaoshujiang/1629084701285.png" alt="enter description here" loading="lazy"></p></li><li><p>执行：virsh console xml文件中的name 进入虚拟机 （root / Admin@9000）</p></li><li><p>修改网络文件获取ip （/etc/sysconfig/network-scripts/ifcfg-eth0）</p></li><li><p>修改es的配置文件为正确的配置 （es的存放目录在 /programs/elasticsearch-7.4.1 ）</p><ul><li><strong>注意</strong>：数据存放和日志存放目录需要 elastic 用户能方法 。 elastic 用户已经默认创建好了</li></ul></li><li><p>启动es (bin/elasticsearch -d)</p></li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">su</span> elastic
<span class="token builtin class-name">cd</span> /programs/elasticsearch-7.4.1
bin/elasticsearch <span class="token parameter variable">-d</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="11"><li>还需要启动nfs</li></ol><h2 id="意外情况" tabindex="-1"><a class="header-anchor" href="#意外情况" aria-hidden="true">#</a> 意外情况</h2><p>上面在执行virsh start xxx 的时候可能会出现下面的几个错。</p><ol><li><p>the cpu is incompatible with host cpu: 主机不提供所需功能：md-clear ssbd - 修改xml直接删除xml文件中的cpu的相关配置信息即可 （应该刚才已经执行了 virsh define 命令，所以这里的修改使用 <strong>virsh edit 虚拟机名字</strong> 来修改）</p></li><li><p>the cput is incompatible with host cpu: 主机不提供所需功能：spec-ctrl .</p><ul><li>这个问题应该就是xml文件中cpu的model不对，请重新检查 上面的2、3两个步骤</li></ul></li></ol><h2 id="虚拟机磁盘扩容" tabindex="-1"><a class="header-anchor" href="#虚拟机磁盘扩容" aria-hidden="true">#</a> 虚拟机磁盘扩容</h2><p>默认情况下上诉步骤跑起来的虚拟机只有10g的磁盘空间。所以需要扩容。 <img src="https://cdn.justdopay.com/xiaoshujiang/1629084721547.png" alt="enter description here" loading="lazy"></p><p>扩容的两种方式：</p><ul><li><p>直接扩容原来的img文件（是一个虚拟硬盘）</p></li><li><p>创建新的img文件然后挂载上去（相当于挂载一个新磁盘）</p></li></ul><h3 id="直接扩容原有img文件" tabindex="-1"><a class="header-anchor" href="#直接扩容原有img文件" aria-hidden="true">#</a> 直接扩容原有img文件</h3><ol><li><p>退出虚拟机进入宿主机，然后执行 <img src="https://cdn.justdopay.com/xiaoshujiang/1629084741406.png" alt="enter description here" loading="lazy"></p></li><li><p>进入虚拟机: virsh console xxxxx 可以看到硬盘容量增加了100G <img src="https://cdn.justdopay.com/xiaoshujiang/1629084754196.png" alt="enter description here" loading="lazy"></p></li><li><p>但增加的容量现在不可用，需要执行： <img src="https://cdn.justdopay.com/xiaoshujiang/1629084776234.png" alt="enter description here" loading="lazy"></p></li><li><p>再看看： <img src="https://cdn.justdopay.com/xiaoshujiang/1629084797758.png" alt="enter description here" loading="lazy"></p></li><li><p>执行reboot，再次进入虚拟机 <img src="https://cdn.justdopay.com/xiaoshujiang/1629084814280.png" alt="enter description here" loading="lazy"></p></li><li><p>格式化新分区 <img src="https://cdn.justdopay.com/xiaoshujiang/1629084829503.png" alt="enter description here" loading="lazy"></p></li><li><p>挂载到某个目录 (这里挂载到 /opt 目录) <img src="https://cdn.justdopay.com/xiaoshujiang/1629084842375.png" alt="enter description here" loading="lazy"></p></li><li><p>修改 /etc/fstab 文件，让虚拟机重启后自动挂载 /dev/vda4分区到 /opt目录下 <img src="https://cdn.justdopay.com/xiaoshujiang/1629084855092.png" alt="enter description here" loading="lazy"></p></li><li><p>重启 reboot ,进入虚拟机，查看挂载情况 <img src="https://cdn.justdopay.com/xiaoshujiang/1629084918061.png" alt="enter description here" loading="lazy"></p></li></ol><h3 id="创建新的img文件然后挂载上去" tabindex="-1"><a class="header-anchor" href="#创建新的img文件然后挂载上去" aria-hidden="true">#</a> 创建新的img文件然后挂载上去</h3><p>这种方式相当于挂载了一个新的硬盘上去</p><ol><li><p>在宿主机创建虚拟硬盘文件 <img src="https://cdn.justdopay.com/xiaoshujiang/1629084943059.png" alt="enter description here" loading="lazy"> .</p></li><li><p>编辑虚拟机的xml文件 virsh edit xxxxx，找到disk相关配置，加入下面的配置：</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>disk</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&#39;</span>file<span class="token punctuation">&#39;</span></span> <span class="token attr-name">device</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&#39;</span>disk<span class="token punctuation">&#39;</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>driver</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&#39;</span>qemu<span class="token punctuation">&#39;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&#39;</span>qcow2<span class="token punctuation">&#39;</span></span><span class="token punctuation">/&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>source</span> <span class="token attr-name">file</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&#39;</span>/pqs/kvm/pqstest/test.img<span class="token punctuation">&#39;</span></span><span class="token punctuation">/&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>target</span> <span class="token attr-name">dev</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&#39;</span>hdf<span class="token punctuation">&#39;</span></span> <span class="token attr-name">bus</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&#39;</span>virtio<span class="token punctuation">&#39;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>disk</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://cdn.justdopay.com/xiaoshujiang/1629084961721.png" alt="enter description here" tabindex="0" loading="lazy"><figcaption>enter description here</figcaption></figure></li><li><p>重启虚拟机，进入虚拟机（好像可以不重启，可自行测试） <img src="https://cdn.justdopay.com/xiaoshujiang/1629084995461.png" alt="enter description here" loading="lazy"></p></li><li><p>查看硬盘情况，出现新的硬盘 <img src="https://cdn.justdopay.com/xiaoshujiang/1629085010430.png" alt="enter description here" loading="lazy"></p></li><li><p>对新硬盘分区（这里只分1个区，可自行决定分几个） <img src="https://cdn.justdopay.com/xiaoshujiang/1629085029363.png" alt="enter description here" loading="lazy"></p></li><li><p>查看硬盘情况，看到新分区 <img src="https://cdn.justdopay.com/xiaoshujiang/1629085054270.png" alt="enter description here" loading="lazy"></p></li><li><p>格式化并挂载新分区到目录下，这个步骤和上面的步骤一样了，不再赘述</p></li></ol><br><h2 id="系统推荐" tabindex="-1"><a class="header-anchor" href="#系统推荐" aria-hidden="true">#</a> 系统推荐</h2>`,25),d=a("p",null,[a("br"),a("br"),a("br"),a("br"),a("br"),a("br")],-1),h=a("hr",null,null,-1),g=a("hr",null,null,-1),m=a("ul",null,[a("li",null,[a("strong",null,"随机毒鸡汤"),n("：谎言和誓言的区别在于，一个是听的人当真了，一个是说的人当真了。 "),a("br"),a("br"),a("img",{src:"https://tuapi.eees.cc/api.php?category=fengjing&type=302&uuid=dc23e0b8-1f3e-4268-ac2c-94735cc47dd4",alt:"",loading:"lazy"})])],-1);function k(x,E){const s=c("RouterLink");return l(),p("div",null,[u,a("ul",null,[a("li",null,[t(s,{to:"/software/docker/Docker%E8%BF%9B%E8%A1%8C%E8%B5%84%E6%BA%90%E9%9A%94%E7%A6%BB.html"},{default:e(()=>[n("Docker进行资源隔离")]),_:1})]),a("li",null,[t(s,{to:"/other/Git%E5%90%88%E5%B9%B6%E5%A4%9A%E4%B8%AA%E6%8F%90%E4%BA%A4%E5%B9%B6push%E5%88%B0%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93.html"},{default:e(()=>[n("Git合并多个提交并push到远程仓库")]),_:1})]),a("li",null,[t(s,{to:"/software/jvm/JDK%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7.html"},{default:e(()=>[n("JDK命令行工具")]),_:1})]),a("li",null,[t(s,{to:"/other/%E5%A6%82%E4%BD%95%E5%AE%89%E8%A3%85Google%20BBR.html"},{default:e(()=>[n("如何安装Google BBR")]),_:1})]),a("li",null,[t(s,{to:"/other/Hadoop%20%E4%B8%80.html"},{default:e(()=>[n("Hadoop 一")]),_:1})]),a("li",null,[t(s,{to:"/software/unclassified/%E7%BA%BF%E4%B8%8AFullGC%E9%A2%91%E7%B9%81%E7%9A%84%E6%8E%92%E6%9F%A5.html"},{default:e(()=>[n("线上FullGC频繁的排查")]),_:1})]),a("li",null,[t(s,{to:"/software/shodowsocks/ShadowsockServerUpdatePort.html"},{default:e(()=>[n("ShadowsockServerUpdatePort")]),_:1})]),a("li",null,[t(s,{to:"/other/%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5%E6%96%B9%E6%A1%88.html"},{default:e(()=>[n("数据同步方案")]),_:1})]),a("li",null,[t(s,{to:"/software/unclassified/%E6%89%B9%E9%87%8F%E4%BF%AE%E6%94%B9git%E5%8E%86%E5%8F%B2%E8%AE%B0%E5%BD%95%E4%B8%AD%E7%9A%84%E7%94%A8%E6%88%B7%E5%90%8D%E5%92%8C%E9%82%AE%E7%AE%B1.html"},{default:e(()=>[n("批量修改git历史记录中的用户名和邮箱")]),_:1})]),a("li",null,[t(s,{to:"/software/unclassified/linux_no_space_left_on_device.html"},{default:e(()=>[n("linux_no_space_left_on_device")]),_:1})]),a("li",null,[t(s,{to:"/software/linux/Linux.html"},{default:e(()=>[n("Linux")]),_:1})]),a("li",null,[t(s,{to:"/other/Linux%20dev%20shm%E7%9B%AE%E5%BD%95.html"},{default:e(()=>[n("Linux dev shm目录")]),_:1})])]),d,h,g,m])}const f=i(r,[["render",k],["__file","KVM方式集群部署ES.html.vue"]]);export{f as default};
