const e=JSON.parse('{"key":"v-0721ad1c","path":"/other/CentOS7%E4%B8%8BDocker%E7%AB%AF%E5%8F%A3%E6%98%A0%E5%B0%84%E5%90%8E%E9%98%B2%E7%81%AB%E5%A2%99%E5%A4%B1%E6%95%88.html","title":"CentOS7下Docker端口映射后防火墙失效","lang":"zh-CN","frontmatter":{"title":"CentOS7下Docker端口映射后防火墙失效","date":"2025-02-12T00:00:00.000Z","description":"背景 Docker 容器添加端口映射后，会自动添加系统防火墙规则，将端口开放给所有ip访问。 使用 firewall-cmd 命令无法查看和管理 Docker 添加的防火墙规则。 使用 iptables 能查看该规则，但对其管理无效（firewalld 底层认识 iptables ，重启 firewalld 服务规则复原） 原因 docker 会自动添加一个优先级最高的针对这个映射端口全开放规则。 解决方案 开启防火墙的 masquerade 包转发功能 centos 系统安装好后运行于主机模式，并没有开启包转发功能。 即系统只处理目的地为本机的数据包，不会转发发往其他地址的数据包。 在内核中有相应配置选项 net.ipv4.ip_forward 默认设置为 0。 可以通过命令 sysctl net.ipv4.ip_forward=1 手动开启包转发功能。 防火墙的 masquerade 功能进行地址伪装（NAT）， 私网访问公网或公网访问私网都需要开启此功能来进行地址转换，否则无法正常互访。 通过命令 firewall-cmd --add-masquerade 开启此功能， 开启之后 net.ipv4.ip_forward 的值自动被设置为1，即 centos 启用包转发。 在 docke r启动时添加参数来禁止 docker 对本机防火墙的操作。","head":[["link",{"rel":"canonical","href":"https://justsoso.fun/other/CentOS7%E4%B8%8BDocker%E7%AB%AF%E5%8F%A3%E6%98%A0%E5%B0%84%E5%90%8E%E9%98%B2%E7%81%AB%E5%A2%99%E5%A4%B1%E6%95%88.html"}],["meta",{"property":"og:url","content":"https://justsoso.fun/other/CentOS7%E4%B8%8BDocker%E7%AB%AF%E5%8F%A3%E6%98%A0%E5%B0%84%E5%90%8E%E9%98%B2%E7%81%AB%E5%A2%99%E5%A4%B1%E6%95%88.html"}],["meta",{"property":"og:site_name","content":"技术加油站"}],["meta",{"property":"og:title","content":"CentOS7下Docker端口映射后防火墙失效"}],["meta",{"property":"og:description","content":"背景 Docker 容器添加端口映射后，会自动添加系统防火墙规则，将端口开放给所有ip访问。 使用 firewall-cmd 命令无法查看和管理 Docker 添加的防火墙规则。 使用 iptables 能查看该规则，但对其管理无效（firewalld 底层认识 iptables ，重启 firewalld 服务规则复原） 原因 docker 会自动添加一个优先级最高的针对这个映射端口全开放规则。 解决方案 开启防火墙的 masquerade 包转发功能 centos 系统安装好后运行于主机模式，并没有开启包转发功能。 即系统只处理目的地为本机的数据包，不会转发发往其他地址的数据包。 在内核中有相应配置选项 net.ipv4.ip_forward 默认设置为 0。 可以通过命令 sysctl net.ipv4.ip_forward=1 手动开启包转发功能。 防火墙的 masquerade 功能进行地址伪装（NAT）， 私网访问公网或公网访问私网都需要开启此功能来进行地址转换，否则无法正常互访。 通过命令 firewall-cmd --add-masquerade 开启此功能， 开启之后 net.ipv4.ip_forward 的值自动被设置为1，即 centos 启用包转发。 在 docke r启动时添加参数来禁止 docker 对本机防火墙的操作。"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-03-30T07:03:23.000Z"}],["meta",{"property":"article:published_time","content":"2025-02-12T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2025-03-30T07:03:23.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"CentOS7下Docker端口映射后防火墙失效\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2025-02-12T00:00:00.000Z\\",\\"dateModified\\":\\"2025-03-30T07:03:23.000Z\\",\\"author\\":[]}"]]},"headers":[{"level":2,"title":"背景","slug":"背景","link":"#背景","children":[]},{"level":2,"title":"原因","slug":"原因","link":"#原因","children":[]},{"level":2,"title":"解决方案","slug":"解决方案","link":"#解决方案","children":[]},{"level":2,"title":"具体步骤","slug":"具体步骤","link":"#具体步骤","children":[]},{"level":2,"title":"系统推荐","slug":"系统推荐","link":"#系统推荐","children":[]}],"git":{"createdTime":1739430239000,"updatedTime":1743318203000,"contributors":[{"name":"rocky-peng","email":"rocky.peng@qq.com","commits":99}]},"readingTime":{"minutes":2.83,"words":848},"filePathRelative":"other/CentOS7下Docker端口映射后防火墙失效.md","localizedDate":"2025年2月12日","excerpt":"<h2> 背景</h2>\\n<ol>\\n<li>Docker 容器添加端口映射后，会自动添加系统防火墙规则，将端口开放给所有ip访问。</li>\\n<li>使用 firewall-cmd 命令无法查看和管理 Docker 添加的防火墙规则。</li>\\n<li>使用 iptables 能查看该规则，但对其管理无效（firewalld 底层认识 iptables ，重启 firewalld 服务规则复原）</li>\\n</ol>\\n<h2> 原因</h2>\\n<p>docker 会自动添加一个优先级最高的针对这个映射端口全开放规则。</p>\\n<h2> 解决方案</h2>\\n<ol>\\n<li>\\n<p>开启防火墙的 masquerade 包转发功能</p>\\n<div class=\\"language-bash line-numbers-mode\\" data-ext=\\"sh\\"><pre class=\\"language-bash\\"><code>centos 系统安装好后运行于主机模式，并没有开启包转发功能。\\n即系统只处理目的地为本机的数据包，不会转发发往其他地址的数据包。\\n在内核中有相应配置选项 net.ipv4.ip_forward 默认设置为 <span class=\\"token number\\">0</span>。\\n可以通过命令 <span class=\\"token function\\">sysctl</span> <span class=\\"token assign-left variable\\">net.ipv4.ip_forward</span><span class=\\"token operator\\">=</span><span class=\\"token number\\">1</span> 手动开启包转发功能。\\n防火墙的 masquerade 功能进行地址伪装（NAT），\\n私网访问公网或公网访问私网都需要开启此功能来进行地址转换，否则无法正常互访。\\n通过命令 firewall-cmd --add-masquerade 开启此功能，\\n开启之后 net.ipv4.ip_forward 的值自动被设置为1，即 centos 启用包转发。\\n</code></pre><div class=\\"line-numbers\\" aria-hidden=\\"true\\"><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div></div></div></li>\\n<li>\\n<p>在 docke r启动时添加参数来禁止 docker 对本机防火墙的操作。</p>\\n</li>\\n</ol>","copyright":{},"autoDesc":true}');export{e as data};
