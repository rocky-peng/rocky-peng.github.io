import{_ as i,$ as l,a0 as p,a1 as a,a3 as t,a4 as e,a5 as o,a2 as n,w as c}from"./framework-58787b1c.js";const r={},u=o(`<h2 id="步骤" tabindex="-1"><a class="header-anchor" href="#步骤" aria-hidden="true">#</a> 步骤</h2><p>本文档模拟的是把kvm镜像拷贝到新机子上进行部署的过程。</p><p>由于多台机子和单台机子上进行部署的过程很类似，所以这里只描述部署一台机子的过程。</p><ol><li><p>一台主机（需要提前安装好kvm）</p></li><li><p>kvm的镜像 （可从192.168.1.99:/kvmimg目录下载）</p></li></ol><figure><img src="https://cdn.justdopay.com/xiaoshujiang/1629084557911.png" alt="enter description here" tabindex="0" loading="lazy"><figcaption>enter description here</figcaption></figure><hr><ol><li><p>把下载的两个文件 es-172.26.43.130.img es-172.26.43.130.xml 上传到主机的某个目录下。 比如（/opt/kvmimg）</p></li><li><p>查看主机的cpu model : virsh capabilities <img src="https://cdn.justdopay.com/xiaoshujiang/1629084574573.png" alt="enter description here" loading="lazy"></p></li><li><p>编辑上传的xml文件，找到cpu相关的xml配置，并修改model为刚才查到的model。 <img src="https://cdn.justdopay.com/xiaoshujiang/1629084589638.png" alt="enter description here" loading="lazy"></p></li></ol><p>上图中的name uuid memory 可自行根据实际情况修改。</p><ol start="4"><li><p>继续修改xml，找到 “es-172.26.43.130.img” 字样的位置，并修改路径为正确的路径。 <img src="https://cdn.justdopay.com/xiaoshujiang/1629084636546.png" alt="enter description here" loading="lazy"></p></li><li><p>执行：virsh define 上传的xml文件路径 <img src="https://cdn.justdopay.com/xiaoshujiang/1629084653784.png" alt="enter description here" loading="lazy"> .</p></li><li><p>执行： virsh start xml文件中的name （可能会有意外情况，请参考下方的 <strong>意外情况</strong>） <img src="https://cdn.justdopay.com/xiaoshujiang/1629084701285.png" alt="enter description here" loading="lazy"></p></li><li><p>执行：virsh console xml文件中的name 进入虚拟机 （root / Admin@9000）</p></li><li><p>修改网络文件获取ip （/etc/sysconfig/network-scripts/ifcfg-eth0）</p></li><li><p>修改es的配置文件为正确的配置 （es的存放目录在 /programs/elasticsearch-7.4.1 ）</p><ul><li><strong>注意</strong>：数据存放和日志存放目录需要 elastic 用户能方法 。 elastic 用户已经默认创建好了</li></ul></li><li><p>启动es (bin/elasticsearch -d)</p></li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">su</span> elastic
<span class="token builtin class-name">cd</span> /programs/elasticsearch-7.4.1
bin/elasticsearch <span class="token parameter variable">-d</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="11"><li>还需要启动nfs</li></ol><h2 id="意外情况" tabindex="-1"><a class="header-anchor" href="#意外情况" aria-hidden="true">#</a> 意外情况</h2><p>上面在执行virsh start xxx 的时候可能会出现下面的几个错。</p><ol><li><p>the cpu is incompatible with host cpu: 主机不提供所需功能：md-clear ssbd - 修改xml直接删除xml文件中的cpu的相关配置信息即可 （应该刚才已经执行了 virsh define 命令，所以这里的修改使用 <strong>virsh edit 虚拟机名字</strong> 来修改）</p></li><li><p>the cput is incompatible with host cpu: 主机不提供所需功能：spec-ctrl .</p><ul><li>这个问题应该就是xml文件中cpu的model不对，请重新检查 上面的2、3两个步骤</li></ul></li></ol><h2 id="虚拟机磁盘扩容" tabindex="-1"><a class="header-anchor" href="#虚拟机磁盘扩容" aria-hidden="true">#</a> 虚拟机磁盘扩容</h2><p>默认情况下上诉步骤跑起来的虚拟机只有10g的磁盘空间。所以需要扩容。 <img src="https://cdn.justdopay.com/xiaoshujiang/1629084721547.png" alt="enter description here" loading="lazy"></p><p>扩容的两种方式：</p><ul><li><p>直接扩容原来的img文件（是一个虚拟硬盘）</p></li><li><p>创建新的img文件然后挂载上去（相当于挂载一个新磁盘）</p></li></ul><h3 id="直接扩容原有img文件" tabindex="-1"><a class="header-anchor" href="#直接扩容原有img文件" aria-hidden="true">#</a> 直接扩容原有img文件</h3><ol><li><p>退出虚拟机进入宿主机，然后执行 <img src="https://cdn.justdopay.com/xiaoshujiang/1629084741406.png" alt="enter description here" loading="lazy"></p></li><li><p>进入虚拟机: virsh console xxxxx 可以看到硬盘容量增加了100G <img src="https://cdn.justdopay.com/xiaoshujiang/1629084754196.png" alt="enter description here" loading="lazy"></p></li><li><p>但增加的容量现在不可用，需要执行： <img src="https://cdn.justdopay.com/xiaoshujiang/1629084776234.png" alt="enter description here" loading="lazy"></p></li><li><p>再看看： <img src="https://cdn.justdopay.com/xiaoshujiang/1629084797758.png" alt="enter description here" loading="lazy"></p></li><li><p>执行reboot，再次进入虚拟机 <img src="https://cdn.justdopay.com/xiaoshujiang/1629084814280.png" alt="enter description here" loading="lazy"></p></li><li><p>格式化新分区 <img src="https://cdn.justdopay.com/xiaoshujiang/1629084829503.png" alt="enter description here" loading="lazy"></p></li><li><p>挂载到某个目录 (这里挂载到 /opt 目录) <img src="https://cdn.justdopay.com/xiaoshujiang/1629084842375.png" alt="enter description here" loading="lazy"></p></li><li><p>修改 /etc/fstab 文件，让虚拟机重启后自动挂载 /dev/vda4分区到 /opt目录下 <img src="https://cdn.justdopay.com/xiaoshujiang/1629084855092.png" alt="enter description here" loading="lazy"></p></li><li><p>重启 reboot ,进入虚拟机，查看挂载情况 <img src="https://cdn.justdopay.com/xiaoshujiang/1629084918061.png" alt="enter description here" loading="lazy"></p></li></ol><h3 id="创建新的img文件然后挂载上去" tabindex="-1"><a class="header-anchor" href="#创建新的img文件然后挂载上去" aria-hidden="true">#</a> 创建新的img文件然后挂载上去</h3><p>这种方式相当于挂载了一个新的硬盘上去</p><ol><li><p>在宿主机创建虚拟硬盘文件 <img src="https://cdn.justdopay.com/xiaoshujiang/1629084943059.png" alt="enter description here" loading="lazy"> .</p></li><li><p>编辑虚拟机的xml文件 virsh edit xxxxx，找到disk相关配置，加入下面的配置：</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>disk</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&#39;</span>file<span class="token punctuation">&#39;</span></span> <span class="token attr-name">device</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&#39;</span>disk<span class="token punctuation">&#39;</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>driver</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&#39;</span>qemu<span class="token punctuation">&#39;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&#39;</span>qcow2<span class="token punctuation">&#39;</span></span><span class="token punctuation">/&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>source</span> <span class="token attr-name">file</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&#39;</span>/pqs/kvm/pqstest/test.img<span class="token punctuation">&#39;</span></span><span class="token punctuation">/&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>target</span> <span class="token attr-name">dev</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&#39;</span>hdf<span class="token punctuation">&#39;</span></span> <span class="token attr-name">bus</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&#39;</span>virtio<span class="token punctuation">&#39;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>disk</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://cdn.justdopay.com/xiaoshujiang/1629084961721.png" alt="enter description here" tabindex="0" loading="lazy"><figcaption>enter description here</figcaption></figure></li><li><p>重启虚拟机，进入虚拟机（好像可以不重启，可自行测试） <img src="https://cdn.justdopay.com/xiaoshujiang/1629084995461.png" alt="enter description here" loading="lazy"></p></li><li><p>查看硬盘情况，出现新的硬盘 <img src="https://cdn.justdopay.com/xiaoshujiang/1629085010430.png" alt="enter description here" loading="lazy"></p></li><li><p>对新硬盘分区（这里只分1个区，可自行决定分几个） <img src="https://cdn.justdopay.com/xiaoshujiang/1629085029363.png" alt="enter description here" loading="lazy"></p></li><li><p>查看硬盘情况，看到新分区 <img src="https://cdn.justdopay.com/xiaoshujiang/1629085054270.png" alt="enter description here" loading="lazy"></p></li><li><p>格式化并挂载新分区到目录下，这个步骤和上面的步骤一样了，不再赘述</p></li></ol><br><h2 id="系统推荐" tabindex="-1"><a class="header-anchor" href="#系统推荐" aria-hidden="true">#</a> 系统推荐</h2>`,25),d=a("p",null,[a("br"),a("br"),a("br"),a("br"),a("br"),a("br")],-1),h=a("hr",null,null,-1),g=a("hr",null,null,-1),m=a("ul",null,[a("li",null,[a("strong",null,"随机毒鸡汤"),n("：间歇性洗心革面，持续性混吃等死。 "),a("br"),a("br"),a("img",{src:"https://tuapi.eees.cc/api.php?category=fengjing&type=302&uuid=073052c7-296d-415a-a2ca-a78f4142b26d",alt:"",loading:"lazy"})])],-1);function E(k,x){const s=c("RouterLink");return l(),p("div",null,[u,a("ul",null,[a("li",null,[t(s,{to:"/software/jvm/JVM%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8.html"},{default:e(()=>[n("JVM垃圾收集器")]),_:1})]),a("li",null,[t(s,{to:"/other/%E5%BE%AE%E5%8D%9A%E5%85%B3%E6%B3%A8%E5%85%B3%E7%B3%BB%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0.html"},{default:e(()=>[n("微博关注关系如何实现")]),_:1})]),a("li",null,[t(s,{to:"/other/CloudFlare%20%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%AF%81%E4%B9%A6%E7%9A%84%E4%BD%BF%E7%94%A8.html"},{default:e(()=>[n("CloudFlare 客户端证书的使用")]),_:1})]),a("li",null,[t(s,{to:"/other/%E9%9A%8F%E8%AE%B0.html"},{default:e(()=>[n("随记")]),_:1})]),a("li",null,[t(s,{to:"/other/K8S%20%E6%97%A0%E6%84%9F%E5%8F%91%E5%B8%83.html"},{default:e(()=>[n("K8S 无感发布")]),_:1})]),a("li",null,[t(s,{to:"/other/MongoDB%E9%AB%98%E5%8F%AF%E7%94%A8.html"},{default:e(()=>[n("MongoDB高可用")]),_:1})]),a("li",null,[t(s,{to:"/software/java-basic/IO%E7%9B%B8%E5%85%B3.html"},{default:e(()=>[n("IO相关")]),_:1})]),a("li",null,[t(s,{to:"/software/unclassified/%E4%B9%B1%E4%B8%83%E5%85%AB%E7%B3%9F%E7%9A%84%E7%AC%94%E8%AE%B0.html"},{default:e(()=>[n("乱七八糟的笔记")]),_:1})]),a("li",null,[t(s,{to:"/software/middleware/mysql/MySQL%E9%94%81%E3%80%81%E4%BA%8B%E5%8A%A1%E3%80%81%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB.html"},{default:e(()=>[n("MySQL锁、事务、隔离级别")]),_:1})]),a("li",null,[t(s,{to:"/software/unclassified/Flutter%E5%BC%80%E5%8F%91%E9%9C%80%E8%A6%81%E6%B6%89%E5%8F%8A%E7%9A%84%E7%9F%A5%E8%AF%86%E7%82%B9%E5%A4%A7%E7%BA%B2.html"},{default:e(()=>[n("Flutter开发需要涉及的知识点大纲")]),_:1})]),a("li",null,[t(s,{to:"/software/java-basic/AQS%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB.html"},{default:e(()=>[n("AQS源码解读")]),_:1})]),a("li",null,[t(s,{to:"/other/vuepress-theme-hope%20%E6%B7%BB%E5%8A%A0%E8%B0%B7%E6%AD%8C%E5%B9%BF%E5%91%8A.html"},{default:e(()=>[n("vuepress-theme-hope 添加谷歌广告")]),_:1})])]),d,h,g,m])}const B=i(r,[["render",E],["__file","KVM方式集群部署ES.html.vue"]]);export{B as default};
