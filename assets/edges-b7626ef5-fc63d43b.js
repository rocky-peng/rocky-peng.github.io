import{c as R,X as u,i as F,an as z,C as T,A as f,K as j,ao as st}from"./mermaid.esm.min-3824ce45.js";import{U as rt}from"./createText-8ec3b59b-df51d35a.js";import{P as lt}from"./line-6e3107d9-8c30c878.js";const ot=(r,t,e,s)=>{t.forEach(a=>{xt[a](r,e,s)})},dt=(r,t,e)=>{f.trace("Making markers for ",e),r.append("defs").append("marker").attr("id",e+"_"+t+"-extensionStart").attr("class","marker extension "+t).attr("refX",18).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 1,7 L18,13 V 1 Z"),r.append("defs").append("marker").attr("id",e+"_"+t+"-extensionEnd").attr("class","marker extension "+t).attr("refX",1).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 1,1 V 13 L18,7 Z")},ct=(r,t,e)=>{r.append("defs").append("marker").attr("id",e+"_"+t+"-compositionStart").attr("class","marker composition "+t).attr("refX",18).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z"),r.append("defs").append("marker").attr("id",e+"_"+t+"-compositionEnd").attr("class","marker composition "+t).attr("refX",1).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z")},ht=(r,t,e)=>{r.append("defs").append("marker").attr("id",e+"_"+t+"-aggregationStart").attr("class","marker aggregation "+t).attr("refX",18).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z"),r.append("defs").append("marker").attr("id",e+"_"+t+"-aggregationEnd").attr("class","marker aggregation "+t).attr("refX",1).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z")},pt=(r,t,e)=>{r.append("defs").append("marker").attr("id",e+"_"+t+"-dependencyStart").attr("class","marker dependency "+t).attr("refX",6).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 5,7 L9,13 L1,7 L9,1 Z"),r.append("defs").append("marker").attr("id",e+"_"+t+"-dependencyEnd").attr("class","marker dependency "+t).attr("refX",13).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L14,7 L9,1 Z")},gt=(r,t,e)=>{r.append("defs").append("marker").attr("id",e+"_"+t+"-lollipopStart").attr("class","marker lollipop "+t).attr("refX",13).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("circle").attr("stroke","black").attr("fill","transparent").attr("cx",7).attr("cy",7).attr("r",6),r.append("defs").append("marker").attr("id",e+"_"+t+"-lollipopEnd").attr("class","marker lollipop "+t).attr("refX",1).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("circle").attr("stroke","black").attr("fill","transparent").attr("cx",7).attr("cy",7).attr("r",6)},yt=(r,t,e)=>{r.append("marker").attr("id",e+"_"+t+"-pointEnd").attr("class","marker "+t).attr("viewBox","0 0 10 10").attr("refX",6).attr("refY",5).attr("markerUnits","userSpaceOnUse").attr("markerWidth",12).attr("markerHeight",12).attr("orient","auto").append("path").attr("d","M 0 0 L 10 5 L 0 10 z").attr("class","arrowMarkerPath").style("stroke-width",1).style("stroke-dasharray","1,0"),r.append("marker").attr("id",e+"_"+t+"-pointStart").attr("class","marker "+t).attr("viewBox","0 0 10 10").attr("refX",4.5).attr("refY",5).attr("markerUnits","userSpaceOnUse").attr("markerWidth",12).attr("markerHeight",12).attr("orient","auto").append("path").attr("d","M 0 5 L 10 10 L 10 0 z").attr("class","arrowMarkerPath").style("stroke-width",1).style("stroke-dasharray","1,0")},ft=(r,t,e)=>{r.append("marker").attr("id",e+"_"+t+"-circleEnd").attr("class","marker "+t).attr("viewBox","0 0 10 10").attr("refX",11).attr("refY",5).attr("markerUnits","userSpaceOnUse").attr("markerWidth",11).attr("markerHeight",11).attr("orient","auto").append("circle").attr("cx","5").attr("cy","5").attr("r","5").attr("class","arrowMarkerPath").style("stroke-width",1).style("stroke-dasharray","1,0"),r.append("marker").attr("id",e+"_"+t+"-circleStart").attr("class","marker "+t).attr("viewBox","0 0 10 10").attr("refX",-1).attr("refY",5).attr("markerUnits","userSpaceOnUse").attr("markerWidth",11).attr("markerHeight",11).attr("orient","auto").append("circle").attr("cx","5").attr("cy","5").attr("r","5").attr("class","arrowMarkerPath").style("stroke-width",1).style("stroke-dasharray","1,0")},bt=(r,t,e)=>{r.append("marker").attr("id",e+"_"+t+"-crossEnd").attr("class","marker cross "+t).attr("viewBox","0 0 11 11").attr("refX",12).attr("refY",5.2).attr("markerUnits","userSpaceOnUse").attr("markerWidth",11).attr("markerHeight",11).attr("orient","auto").append("path").attr("d","M 1,1 l 9,9 M 10,1 l -9,9").attr("class","arrowMarkerPath").style("stroke-width",2).style("stroke-dasharray","1,0"),r.append("marker").attr("id",e+"_"+t+"-crossStart").attr("class","marker cross "+t).attr("viewBox","0 0 11 11").attr("refX",-1).attr("refY",5.2).attr("markerUnits","userSpaceOnUse").attr("markerWidth",11).attr("markerHeight",11).attr("orient","auto").append("path").attr("d","M 1,1 l 9,9 M 10,1 l -9,9").attr("class","arrowMarkerPath").style("stroke-width",2).style("stroke-dasharray","1,0")},wt=(r,t,e)=>{r.append("defs").append("marker").attr("id",e+"_"+t+"-barbEnd").attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",14).attr("markerUnits","strokeWidth").attr("orient","auto").append("path").attr("d","M 19,7 L9,13 L14,7 L9,1 Z")},xt={extension:dt,composition:ct,aggregation:ht,dependency:pt,lollipop:gt,point:yt,circle:ft,cross:bt,barb:wt},ee=ot;function ut(r,t){t&&r.attr("style",t)}function mt(r){const t=T(document.createElementNS("http://www.w3.org/2000/svg","foreignObject")),e=t.append("xhtml:div"),s=r.label,a=r.isNode?"nodeLabel":"edgeLabel";return e.html('<span class="'+a+'" '+(r.labelStyle?'style="'+r.labelStyle+'"':"")+">"+s+"</span>"),ut(e,r.labelStyle),e.style("display","inline-block"),e.style("white-space","nowrap"),e.attr("xmlns","http://www.w3.org/1999/xhtml"),t.node()}const kt=(r,t,e,s)=>{let a=r||"";if(typeof a=="object"&&(a=a[0]),R(u().flowchart.htmlLabels)){a=a.replace(/\\n|\n/g,"<br />"),f.info("vertexText"+a);const n={isNode:s,label:z(a).replace(/fa[blrs]?:fa-[\w-]+/g,i=>`<i class='${i.replace(":"," ")}'></i>`),labelStyle:t.replace("fill:","color:")};return mt(n)}else{const n=document.createElementNS("http://www.w3.org/2000/svg","text");n.setAttribute("style",t.replace("color:","fill:"));let i=[];typeof a=="string"?i=a.split(/\\n|\n|<br\s*\/?>/gi):Array.isArray(a)?i=a:i=[];for(const l of i){const o=document.createElementNS("http://www.w3.org/2000/svg","tspan");o.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve"),o.setAttribute("dy","1em"),o.setAttribute("x","0"),e?o.setAttribute("class","title-row"):o.setAttribute("class","row"),o.textContent=l.trim(),n.appendChild(o)}return n}},X=kt,E=async(r,t,e,s)=>{let a;const n=t.useHtmlLabels||R(u().flowchart.htmlLabels);e?a=e:a="node default";const i=r.insert("g").attr("class",a).attr("id",t.domId||t.id),l=i.insert("g").attr("class","label").attr("style",t.labelStyle);let o;t.labelText===void 0?o="":o=typeof t.labelText=="string"?t.labelText:t.labelText[0];const c=l.node();let d;t.labelType==="markdown"?d=rt(l,F(z(o),u()),{useHtmlLabels:n,width:t.width||u().flowchart.wrappingWidth,classes:"markdown-node-label"}):d=c.appendChild(X(F(z(o),u()),t.labelStyle,!1,s));let h=d.getBBox();const g=t.padding/2;if(R(u().flowchart.htmlLabels)){const p=d.children[0],x=T(d),k=p.getElementsByTagName("img");if(k){const w=o.replace(/<img[^>]*>/g,"").trim()==="";await Promise.all([...k].map(y=>new Promise(b=>{function M(){if(y.style.display="flex",y.style.flexDirection="column",w){const B=u().fontSize?u().fontSize:window.getComputedStyle(document.body).fontSize,O=5;y.style.width=parseInt(B,10)*O+"px"}else y.style.width="100%";b(y)}setTimeout(()=>{y.complete&&M()}),y.addEventListener("error",M),y.addEventListener("load",M)})))}h=p.getBoundingClientRect(),x.attr("width",h.width),x.attr("height",h.height)}return n?l.attr("transform","translate("+-h.width/2+", "+-h.height/2+")"):l.attr("transform","translate(0, "+-h.height/2+")"),t.centerLabel&&l.attr("transform","translate("+-h.width/2+", "+-h.height/2+")"),l.insert("rect",":first-child"),{shapeSvg:i,bbox:h,halfPadding:g,label:l}},L=(r,t)=>{const e=t.node().getBBox();r.width=e.width,r.height=e.height};function $(r,t,e,s){return r.insert("polygon",":first-child").attr("points",s.map(function(a){return a.x+","+a.y}).join(" ")).attr("class","label-container").attr("transform","translate("+-t/2+","+e/2+")")}function Lt(r,t){return r.intersect(t)}function at(r,t,e,s){var a=r.x,n=r.y,i=a-s.x,l=n-s.y,o=Math.sqrt(t*t*l*l+e*e*i*i),c=Math.abs(t*e*i/o);s.x<a&&(c=-c);var d=Math.abs(t*e*l/o);return s.y<n&&(d=-d),{x:a+c,y:n+d}}function St(r,t,e){return at(r,t,t,e)}function vt(r,t,e,s){var a,n,i,l,o,c,d,h,g,p,x,k,w,y,b;if(a=t.y-r.y,i=r.x-t.x,o=t.x*r.y-r.x*t.y,g=a*e.x+i*e.y+o,p=a*s.x+i*s.y+o,!(g!==0&&p!==0&&J(g,p))&&(n=s.y-e.y,l=e.x-s.x,c=s.x*e.y-e.x*s.y,d=n*r.x+l*r.y+c,h=n*t.x+l*t.y+c,!(d!==0&&h!==0&&J(d,h))&&(x=a*l-n*i,x!==0)))return k=Math.abs(x/2),w=i*c-l*o,y=w<0?(w-k)/x:(w+k)/x,w=n*o-a*c,b=w<0?(w-k)/x:(w+k)/x,{x:y,y:b}}function J(r,t){return r*t>0}function _t(r,t,e){var s=r.x,a=r.y,n=[],i=Number.POSITIVE_INFINITY,l=Number.POSITIVE_INFINITY;typeof t.forEach=="function"?t.forEach(function(x){i=Math.min(i,x.x),l=Math.min(l,x.y)}):(i=Math.min(i,t.x),l=Math.min(l,t.y));for(var o=s-r.width/2-i,c=a-r.height/2-l,d=0;d<t.length;d++){var h=t[d],g=t[d<t.length-1?d+1:0],p=vt(r,e,{x:o+h.x,y:c+h.y},{x:o+g.x,y:c+g.y});p&&n.push(p)}return n.length?(n.length>1&&n.sort(function(x,k){var w=x.x-e.x,y=x.y-e.y,b=Math.sqrt(w*w+y*y),M=k.x-e.x,B=k.y-e.y,O=Math.sqrt(M*M+B*B);return b<O?-1:b===O?0:1}),n[0]):r}const Mt=(r,t)=>{var e=r.x,s=r.y,a=t.x-e,n=t.y-s,i=r.width/2,l=r.height/2,o,c;return Math.abs(n)*i>Math.abs(a)*l?(n<0&&(l=-l),o=n===0?0:l*a/n,c=l):(a<0&&(i=-i),o=i,c=a===0?0:i*n/a),{x:e+o,y:s+c}},Tt=Mt,m={node:Lt,circle:St,ellipse:at,polygon:_t,rect:Tt},Et=async(r,t)=>{t.useHtmlLabels||u().flowchart.htmlLabels||(t.centerLabel=!0);const{shapeSvg:e,bbox:s,halfPadding:a}=await E(r,t,"node "+t.classes,!0);f.info("Classes = ",t.classes);const n=e.insert("rect",":first-child");return n.attr("rx",t.rx).attr("ry",t.ry).attr("x",-s.width/2-a).attr("y",-s.height/2-a).attr("width",s.width+t.padding).attr("height",s.height+t.padding),L(t,n),t.intersect=function(i){return m.rect(t,i)},e},Bt=Et,K=r=>r?" "+r:"",P=(r,t)=>`${t||"node default"}${K(r.classes)} ${K(r.class)}`,Q=async(r,t)=>{const{shapeSvg:e,bbox:s}=await E(r,t,P(t,void 0),!0),a=s.width+t.padding,n=s.height+t.padding,i=a+n,l=[{x:i/2,y:0},{x:i,y:-i/2},{x:i/2,y:-i},{x:0,y:-i/2}];f.info("Question main (Circle)");const o=$(e,i,i,l);return o.attr("style",t.style),L(t,o),t.intersect=function(c){return f.warn("Intersect called"),m.polygon(t,l,c)},e},Ct=(r,t)=>{const e=r.insert("g").attr("class","node default").attr("id",t.domId||t.id),s=28,a=[{x:0,y:s/2},{x:s/2,y:0},{x:0,y:-s/2},{x:-s/2,y:0}];return e.insert("polygon",":first-child").attr("points",a.map(function(n){return n.x+","+n.y}).join(" ")).attr("class","state-start").attr("r",7).attr("width",28).attr("height",28),t.width=28,t.height=28,t.intersect=function(n){return m.circle(t,14,n)},e},Pt=async(r,t)=>{const{shapeSvg:e,bbox:s}=await E(r,t,P(t,void 0),!0),a=4,n=s.height+t.padding,i=n/a,l=s.width+2*i+t.padding,o=[{x:i,y:0},{x:l-i,y:0},{x:l,y:-n/2},{x:l-i,y:-n},{x:i,y:-n},{x:0,y:-n/2}],c=$(e,l,n,o);return c.attr("style",t.style),L(t,c),t.intersect=function(d){return m.polygon(t,o,d)},e},Xt=async(r,t)=>{const{shapeSvg:e,bbox:s}=await E(r,t,P(t,void 0),!0),a=s.width+t.padding,n=s.height+t.padding,i=[{x:-n/2,y:0},{x:a,y:0},{x:a,y:-n},{x:-n/2,y:-n},{x:0,y:-n/2}];return $(e,a,n,i).attr("style",t.style),t.width=a+n,t.height=n,t.intersect=function(l){return m.polygon(t,i,l)},e},Rt=async(r,t)=>{const{shapeSvg:e,bbox:s}=await E(r,t,P(t),!0),a=s.width+t.padding,n=s.height+t.padding,i=[{x:-2*n/6,y:0},{x:a-n/6,y:0},{x:a+2*n/6,y:-n},{x:n/6,y:-n}],l=$(e,a,n,i);return l.attr("style",t.style),L(t,l),t.intersect=function(o){return m.polygon(t,i,o)},e},Yt=async(r,t)=>{const{shapeSvg:e,bbox:s}=await E(r,t,P(t,void 0),!0),a=s.width+t.padding,n=s.height+t.padding,i=[{x:2*n/6,y:0},{x:a+n/6,y:0},{x:a-2*n/6,y:-n},{x:-n/6,y:-n}],l=$(e,a,n,i);return l.attr("style",t.style),L(t,l),t.intersect=function(o){return m.polygon(t,i,o)},e},$t=async(r,t)=>{const{shapeSvg:e,bbox:s}=await E(r,t,P(t,void 0),!0),a=s.width+t.padding,n=s.height+t.padding,i=[{x:-2*n/6,y:0},{x:a+2*n/6,y:0},{x:a-n/6,y:-n},{x:n/6,y:-n}],l=$(e,a,n,i);return l.attr("style",t.style),L(t,l),t.intersect=function(o){return m.polygon(t,i,o)},e},It=async(r,t)=>{const{shapeSvg:e,bbox:s}=await E(r,t,P(t,void 0),!0),a=s.width+t.padding,n=s.height+t.padding,i=[{x:n/6,y:0},{x:a-n/6,y:0},{x:a+2*n/6,y:-n},{x:-2*n/6,y:-n}],l=$(e,a,n,i);return l.attr("style",t.style),L(t,l),t.intersect=function(o){return m.polygon(t,i,o)},e},Ot=async(r,t)=>{const{shapeSvg:e,bbox:s}=await E(r,t,P(t,void 0),!0),a=s.width+t.padding,n=s.height+t.padding,i=[{x:0,y:0},{x:a+n/2,y:0},{x:a,y:-n/2},{x:a+n/2,y:-n},{x:0,y:-n}],l=$(e,a,n,i);return l.attr("style",t.style),L(t,l),t.intersect=function(o){return m.polygon(t,i,o)},e},Ht=async(r,t)=>{const{shapeSvg:e,bbox:s}=await E(r,t,P(t,void 0),!0),a=s.width+t.padding,n=a/2,i=n/(2.5+a/50),l=s.height+i+t.padding,o="M 0,"+i+" a "+n+","+i+" 0,0,0 "+a+" 0 a "+n+","+i+" 0,0,0 "+-a+" 0 l 0,"+l+" a "+n+","+i+" 0,0,0 "+a+" 0 l 0,"+-l,c=e.attr("label-offset-y",i).insert("path",":first-child").attr("style",t.style).attr("d",o).attr("transform","translate("+-a/2+","+-(l/2+i)+")");return L(t,c),t.intersect=function(d){const h=m.rect(t,d),g=h.x-t.x;if(n!=0&&(Math.abs(g)<t.width/2||Math.abs(g)==t.width/2&&Math.abs(h.y-t.y)>t.height/2-i)){let p=i*i*(1-g*g/(n*n));p!=0&&(p=Math.sqrt(p)),p=i-p,d.y-t.y>0&&(p=-p),h.y+=p}return h},e},Nt=async(r,t)=>{const{shapeSvg:e,bbox:s,halfPadding:a}=await E(r,t,"node "+t.classes+" "+t.class,!0),n=e.insert("rect",":first-child"),i=s.width+t.padding,l=s.height+t.padding;if(n.attr("class","basic label-container").attr("style",t.style).attr("rx",t.rx).attr("ry",t.ry).attr("x",-s.width/2-a).attr("y",-s.height/2-a).attr("width",i).attr("height",l),t.props){const o=new Set(Object.keys(t.props));t.props.borders&&(nt(n,t.props.borders,i,l),o.delete("borders")),o.forEach(c=>{f.warn(`Unknown node property ${c}`)})}return L(t,n),t.intersect=function(o){return m.rect(t,o)},e},Wt=async(r,t)=>{const{shapeSvg:e}=await E(r,t,"label",!0);f.trace("Classes = ",t.class);const s=e.insert("rect",":first-child"),a=0,n=0;if(s.attr("width",a).attr("height",n),e.attr("class","label edgeLabel"),t.props){const i=new Set(Object.keys(t.props));t.props.borders&&(nt(s,t.props.borders,a,n),i.delete("borders")),i.forEach(l=>{f.warn(`Unknown node property ${l}`)})}return L(t,s),t.intersect=function(i){return m.rect(t,i)},e};function nt(r,t,e,s){const a=[],n=l=>{a.push(l,0)},i=l=>{a.push(0,l)};t.includes("t")?(f.debug("add top border"),n(e)):i(e),t.includes("r")?(f.debug("add right border"),n(s)):i(s),t.includes("b")?(f.debug("add bottom border"),n(e)):i(e),t.includes("l")?(f.debug("add left border"),n(s)):i(s),r.attr("stroke-dasharray",a.join(" "))}const jt=(r,t)=>{let e;t.classes?e="node "+t.classes:e="node default";const s=r.insert("g").attr("class",e).attr("id",t.domId||t.id),a=s.insert("rect",":first-child"),n=s.insert("line"),i=s.insert("g").attr("class","label"),l=t.labelText.flat?t.labelText.flat():t.labelText;let o="";typeof l=="object"?o=l[0]:o=l,f.info("Label text abc79",o,l,typeof l=="object");const c=i.node().appendChild(X(o,t.labelStyle,!0,!0));let d={width:0,height:0};if(R(u().flowchart.htmlLabels)){const k=c.children[0],w=T(c);d=k.getBoundingClientRect(),w.attr("width",d.width),w.attr("height",d.height)}f.info("Text 2",l);const h=l.slice(1,l.length);let g=c.getBBox();const p=i.node().appendChild(X(h.join?h.join("<br/>"):h,t.labelStyle,!0,!0));if(R(u().flowchart.htmlLabels)){const k=p.children[0],w=T(p);d=k.getBoundingClientRect(),w.attr("width",d.width),w.attr("height",d.height)}const x=t.padding/2;return T(p).attr("transform","translate( "+(d.width>g.width?0:(g.width-d.width)/2)+", "+(g.height+x+5)+")"),T(c).attr("transform","translate( "+(d.width<g.width?0:-(g.width-d.width)/2)+", 0)"),d=i.node().getBBox(),i.attr("transform","translate("+-d.width/2+", "+(-d.height/2-x+3)+")"),a.attr("class","outer title-state").attr("x",-d.width/2-x).attr("y",-d.height/2-x).attr("width",d.width+t.padding).attr("height",d.height+t.padding),n.attr("class","divider").attr("x1",-d.width/2-x).attr("x2",d.width/2+x).attr("y1",-d.height/2-x+g.height+x).attr("y2",-d.height/2-x+g.height+x),L(t,a),t.intersect=function(k){return m.rect(t,k)},s},Dt=async(r,t)=>{const{shapeSvg:e,bbox:s}=await E(r,t,P(t,void 0),!0),a=s.height+t.padding,n=s.width+a/4+t.padding,i=e.insert("rect",":first-child").attr("style",t.style).attr("rx",a/2).attr("ry",a/2).attr("x",-n/2).attr("y",-a/2).attr("width",n).attr("height",a);return L(t,i),t.intersect=function(l){return m.rect(t,l)},e},Ut=async(r,t)=>{const{shapeSvg:e,bbox:s,halfPadding:a}=await E(r,t,P(t,void 0),!0),n=e.insert("circle",":first-child");return n.attr("style",t.style).attr("rx",t.rx).attr("ry",t.ry).attr("r",s.width/2+a).attr("width",s.width+t.padding).attr("height",s.height+t.padding),f.info("Circle main"),L(t,n),t.intersect=function(i){return f.info("Circle intersect",t,s.width/2+a,i),m.circle(t,s.width/2+a,i)},e},At=async(r,t)=>{const{shapeSvg:e,bbox:s,halfPadding:a}=await E(r,t,P(t,void 0),!0),n=5,i=e.insert("g",":first-child"),l=i.insert("circle"),o=i.insert("circle");return i.attr("class",t.class),l.attr("style",t.style).attr("rx",t.rx).attr("ry",t.ry).attr("r",s.width/2+a+n).attr("width",s.width+t.padding+n*2).attr("height",s.height+t.padding+n*2),o.attr("style",t.style).attr("rx",t.rx).attr("ry",t.ry).attr("r",s.width/2+a).attr("width",s.width+t.padding).attr("height",s.height+t.padding),f.info("DoubleCircle main"),L(t,l),t.intersect=function(c){return f.info("DoubleCircle intersect",t,s.width/2+a+n,c),m.circle(t,s.width/2+a+n,c)},e},Zt=async(r,t)=>{const{shapeSvg:e,bbox:s}=await E(r,t,P(t,void 0),!0),a=s.width+t.padding,n=s.height+t.padding,i=[{x:0,y:0},{x:a,y:0},{x:a,y:-n},{x:0,y:-n},{x:0,y:0},{x:-8,y:0},{x:a+8,y:0},{x:a+8,y:-n},{x:-8,y:-n},{x:-8,y:0}],l=$(e,a,n,i);return l.attr("style",t.style),L(t,l),t.intersect=function(o){return m.polygon(t,i,o)},e},qt=(r,t)=>{const e=r.insert("g").attr("class","node default").attr("id",t.domId||t.id),s=e.insert("circle",":first-child");return s.attr("class","state-start").attr("r",7).attr("width",14).attr("height",14),L(t,s),t.intersect=function(a){return m.circle(t,7,a)},e},G=(r,t,e)=>{const s=r.insert("g").attr("class","node default").attr("id",t.domId||t.id);let a=70,n=10;e==="LR"&&(a=10,n=70);const i=s.append("rect").attr("x",-1*a/2).attr("y",-1*n/2).attr("width",a).attr("height",n).attr("class","fork-join");return L(t,i),t.height=t.height+t.padding/2,t.width=t.width+t.padding/2,t.intersect=function(l){return m.rect(t,l)},s},zt=(r,t)=>{const e=r.insert("g").attr("class","node default").attr("id",t.domId||t.id),s=e.insert("circle",":first-child"),a=e.insert("circle",":first-child");return a.attr("class","state-start").attr("r",7).attr("width",14).attr("height",14),s.attr("class","state-end").attr("r",5).attr("width",10).attr("height",10),L(t,a),t.intersect=function(n){return m.circle(t,7,n)},e},Vt=(r,t)=>{const e=t.padding/2,s=4,a=8;let n;t.classes?n="node "+t.classes:n="node default";const i=r.insert("g").attr("class",n).attr("id",t.domId||t.id),l=i.insert("rect",":first-child"),o=i.insert("line"),c=i.insert("line");let d=0,h=s;const g=i.insert("g").attr("class","label");let p=0;const x=t.classData.annotations&&t.classData.annotations[0],k=t.classData.annotations[0]?"«"+t.classData.annotations[0]+"»":"",w=g.node().appendChild(X(k,t.labelStyle,!0,!0));let y=w.getBBox();if(R(u().flowchart.htmlLabels)){const S=w.children[0],v=T(w);y=S.getBoundingClientRect(),v.attr("width",y.width),v.attr("height",y.height)}t.classData.annotations[0]&&(h+=y.height+s,d+=y.width);let b=t.classData.label;t.classData.type!==void 0&&t.classData.type!==""&&(u().flowchart.htmlLabels?b+="&lt;"+t.classData.type+"&gt;":b+="<"+t.classData.type+">");const M=g.node().appendChild(X(b,t.labelStyle,!0,!0));T(M).attr("class","classTitle");let B=M.getBBox();if(R(u().flowchart.htmlLabels)){const S=M.children[0],v=T(M);B=S.getBoundingClientRect(),v.attr("width",B.width),v.attr("height",B.height)}h+=B.height+s,B.width>d&&(d=B.width);const O=[];t.classData.members.forEach(S=>{const v=S.getDisplayDetails();let H=v.displayText;u().flowchart.htmlLabels&&(H=H.replace(/</g,"&lt;").replace(/>/g,"&gt;"));const Y=g.node().appendChild(X(H,v.cssStyle?v.cssStyle:t.labelStyle,!0,!0));let C=Y.getBBox();if(R(u().flowchart.htmlLabels)){const q=Y.children[0],W=T(Y);C=q.getBoundingClientRect(),W.attr("width",C.width),W.attr("height",C.height)}C.width>d&&(d=C.width),h+=C.height+s,O.push(Y)}),h+=a;const V=[];if(t.classData.methods.forEach(S=>{const v=S.getDisplayDetails();let H=v.displayText;u().flowchart.htmlLabels&&(H=H.replace(/</g,"&lt;").replace(/>/g,"&gt;"));const Y=g.node().appendChild(X(H,v.cssStyle?v.cssStyle:t.labelStyle,!0,!0));let C=Y.getBBox();if(R(u().flowchart.htmlLabels)){const q=Y.children[0],W=T(Y);C=q.getBoundingClientRect(),W.attr("width",C.width),W.attr("height",C.height)}C.width>d&&(d=C.width),h+=C.height+s,V.push(Y)}),h+=a,x){let S=(d-y.width)/2;T(w).attr("transform","translate( "+(-1*d/2+S)+", "+-1*h/2+")"),p=y.height+s}let it=(d-B.width)/2;return T(M).attr("transform","translate( "+(-1*d/2+it)+", "+(-1*h/2+p)+")"),p+=B.height+s,o.attr("class","divider").attr("x1",-d/2-e).attr("x2",d/2+e).attr("y1",-h/2-e+a+p).attr("y2",-h/2-e+a+p),p+=a,O.forEach(S=>{T(S).attr("transform","translate( "+-d/2+", "+(-1*h/2+p+a/2)+")");const v=S==null?void 0:S.getBBox();p+=((v==null?void 0:v.height)??0)+s}),p+=a,c.attr("class","divider").attr("x1",-d/2-e).attr("x2",d/2+e).attr("y1",-h/2-e+a+p).attr("y2",-h/2-e+a+p),p+=a,V.forEach(S=>{T(S).attr("transform","translate( "+-d/2+", "+(-1*h/2+p)+")");const v=S==null?void 0:S.getBBox();p+=((v==null?void 0:v.height)??0)+s}),l.attr("class","outer title-state").attr("x",-d/2-e).attr("y",-(h/2)-e).attr("width",d+t.padding).attr("height",h+t.padding),L(t,l),t.intersect=function(S){return m.rect(t,S)},i},tt={rhombus:Q,question:Q,rect:Nt,labelRect:Wt,rectWithTitle:jt,choice:Ct,circle:Ut,doublecircle:At,stadium:Dt,hexagon:Pt,rect_left_inv_arrow:Xt,lean_right:Rt,lean_left:Yt,trapezoid:$t,inv_trapezoid:It,rect_right_inv_arrow:Ot,cylinder:Ht,start:qt,end:zt,note:Bt,subroutine:Zt,fork:G,join:G,class_box:Vt};let N={};const re=async(r,t,e)=>{let s,a;if(t.link){let n;u().securityLevel==="sandbox"?n="_top":t.linkTarget&&(n=t.linkTarget||"_blank"),s=r.insert("svg:a").attr("xlink:href",t.link).attr("target",n),a=await tt[t.shape](s,t,e)}else a=await tt[t.shape](r,t,e),s=a;return t.tooltip&&a.attr("title",t.tooltip),t.class&&a.attr("class","node default "+t.class),N[t.id]=s,t.haveCallback&&N[t.id].attr("class",N[t.id].attr("class")+" clickable"),s},ae=(r,t)=>{N[t.id]=r},ne=()=>{N={}},ie=r=>{const t=N[r.id];f.trace("Transforming node",r.diff,r,"translate("+(r.x-r.width/2-5)+", "+r.width/2+")");const e=8,s=r.diff||0;return r.clusterNode?t.attr("transform","translate("+(r.x+s-r.width/2)+", "+(r.y-r.height/2-e)+")"):t.attr("transform","translate("+r.x+", "+r.y+")"),s},I={aggregation:18,extension:18,composition:18,dependency:6,lollipop:13.5,arrow_point:5.3};function D(r,t){r=A(r),t=A(t);const[e,s]=[r.x,r.y],[a,n]=[t.x,t.y],i=a-e,l=n-s;return{angle:Math.atan(l/i),deltaX:i,deltaY:l}}const A=r=>Array.isArray(r)?{x:r[0],y:r[1]}:r,Ft=r=>({x:function(t,e,s){let a=0;if(e===0&&Object.hasOwn(I,r.arrowTypeStart)){const{angle:n,deltaX:i}=D(s[0],s[1]);a=I[r.arrowTypeStart]*Math.cos(n)*(i>=0?1:-1)}else if(e===s.length-1&&Object.hasOwn(I,r.arrowTypeEnd)){const{angle:n,deltaX:i}=D(s[s.length-1],s[s.length-2]);a=I[r.arrowTypeEnd]*Math.cos(n)*(i>=0?1:-1)}return A(t).x+a},y:function(t,e,s){let a=0;if(e===0&&Object.hasOwn(I,r.arrowTypeStart)){const{angle:n,deltaY:i}=D(s[0],s[1]);a=I[r.arrowTypeStart]*Math.abs(Math.sin(n))*(i>=0?1:-1)}else if(e===s.length-1&&Object.hasOwn(I,r.arrowTypeEnd)){const{angle:n,deltaY:i}=D(s[s.length-1],s[s.length-2]);a=I[r.arrowTypeEnd]*Math.abs(Math.sin(n))*(i>=0?1:-1)}return A(t).y+a}});let Z={},_={};const se=()=>{Z={},_={}},le=(r,t)=>{const e=R(u().flowchart.htmlLabels),s=t.labelType==="markdown"?rt(r,t.label,{style:t.labelStyle,useHtmlLabels:e,addSvgBackground:!0}):X(t.label,t.labelStyle);f.info("abc82",t,t.labelType);const a=r.insert("g").attr("class","edgeLabel"),n=a.insert("g").attr("class","label");n.node().appendChild(s);let i=s.getBBox();if(e){const o=s.children[0],c=T(s);i=o.getBoundingClientRect(),c.attr("width",i.width),c.attr("height",i.height)}n.attr("transform","translate("+-i.width/2+", "+-i.height/2+")"),Z[t.id]=a,t.width=i.width,t.height=i.height;let l;if(t.startLabelLeft){const o=X(t.startLabelLeft,t.labelStyle),c=r.insert("g").attr("class","edgeTerminals"),d=c.insert("g").attr("class","inner");l=d.node().appendChild(o);const h=o.getBBox();d.attr("transform","translate("+-h.width/2+", "+-h.height/2+")"),_[t.id]||(_[t.id]={}),_[t.id].startLeft=c,U(l,t.startLabelLeft)}if(t.startLabelRight){const o=X(t.startLabelRight,t.labelStyle),c=r.insert("g").attr("class","edgeTerminals"),d=c.insert("g").attr("class","inner");l=c.node().appendChild(o),d.node().appendChild(o);const h=o.getBBox();d.attr("transform","translate("+-h.width/2+", "+-h.height/2+")"),_[t.id]||(_[t.id]={}),_[t.id].startRight=c,U(l,t.startLabelRight)}if(t.endLabelLeft){const o=X(t.endLabelLeft,t.labelStyle),c=r.insert("g").attr("class","edgeTerminals"),d=c.insert("g").attr("class","inner");l=d.node().appendChild(o);const h=o.getBBox();d.attr("transform","translate("+-h.width/2+", "+-h.height/2+")"),c.node().appendChild(o),_[t.id]||(_[t.id]={}),_[t.id].endLeft=c,U(l,t.endLabelLeft)}if(t.endLabelRight){const o=X(t.endLabelRight,t.labelStyle),c=r.insert("g").attr("class","edgeTerminals"),d=c.insert("g").attr("class","inner");l=d.node().appendChild(o);const h=o.getBBox();d.attr("transform","translate("+-h.width/2+", "+-h.height/2+")"),c.node().appendChild(o),_[t.id]||(_[t.id]={}),_[t.id].endRight=c,U(l,t.endLabelRight)}return s};function U(r,t){u().flowchart.htmlLabels&&r&&(r.style.width=t.length*9+"px",r.style.height="12px")}const oe=(r,t)=>{f.info("Moving label abc78 ",r.id,r.label,Z[r.id]);let e=t.updatedPath?t.updatedPath:t.originalPath;if(r.label){const s=Z[r.id];let a=r.x,n=r.y;if(e){const i=j.calcLabelPosition(e);f.info("Moving label "+r.label+" from (",a,",",n,") to (",i.x,",",i.y,") abc78"),t.updatedPath&&(a=i.x,n=i.y)}s.attr("transform","translate("+a+", "+n+")")}if(r.startLabelLeft){const s=_[r.id].startLeft;let a=r.x,n=r.y;if(e){const i=j.calcTerminalLabelPosition(r.arrowTypeStart?10:0,"start_left",e);a=i.x,n=i.y}s.attr("transform","translate("+a+", "+n+")")}if(r.startLabelRight){const s=_[r.id].startRight;let a=r.x,n=r.y;if(e){const i=j.calcTerminalLabelPosition(r.arrowTypeStart?10:0,"start_right",e);a=i.x,n=i.y}s.attr("transform","translate("+a+", "+n+")")}if(r.endLabelLeft){const s=_[r.id].endLeft;let a=r.x,n=r.y;if(e){const i=j.calcTerminalLabelPosition(r.arrowTypeEnd?10:0,"end_left",e);a=i.x,n=i.y}s.attr("transform","translate("+a+", "+n+")")}if(r.endLabelRight){const s=_[r.id].endRight;let a=r.x,n=r.y;if(e){const i=j.calcTerminalLabelPosition(r.arrowTypeEnd?10:0,"end_right",e);a=i.x,n=i.y}s.attr("transform","translate("+a+", "+n+")")}},Jt=(r,t)=>{const e=r.x,s=r.y,a=Math.abs(t.x-e),n=Math.abs(t.y-s),i=r.width/2,l=r.height/2;return a>=i||n>=l},Kt=(r,t,e)=>{f.warn(`intersection calc abc89:
  outsidePoint: ${JSON.stringify(t)}
  insidePoint : ${JSON.stringify(e)}
  node        : x:${r.x} y:${r.y} w:${r.width} h:${r.height}`);const s=r.x,a=r.y,n=Math.abs(s-e.x),i=r.width/2;let l=e.x<t.x?i-n:i+n;const o=r.height/2,c=Math.abs(t.y-e.y),d=Math.abs(t.x-e.x);if(Math.abs(a-t.y)*i>Math.abs(s-t.x)*o){let h=e.y<t.y?t.y-o-a:a-o-t.y;l=d*h/c;const g={x:e.x<t.x?e.x+l:e.x-d+l,y:e.y<t.y?e.y+c-h:e.y-c+h};return l===0&&(g.x=t.x,g.y=t.y),d===0&&(g.x=t.x),c===0&&(g.y=t.y),f.warn(`abc89 topp/bott calc, Q ${c}, q ${h}, R ${d}, r ${l}`,g),g}else{e.x<t.x?l=t.x-i-s:l=s-i-t.x;let h=c*l/d,g=e.x<t.x?e.x+d-l:e.x-d+l,p=e.y<t.y?e.y+h:e.y-h;return f.warn(`sides calc abc89, Q ${c}, q ${h}, R ${d}, r ${l}`,{_x:g,_y:p}),l===0&&(g=t.x,p=t.y),d===0&&(g=t.x),c===0&&(p=t.y),{x:g,y:p}}},et=(r,t)=>{f.warn("abc88 cutPathAtIntersect",r,t);let e=[],s=r[0],a=!1;return r.forEach(n=>{if(f.info("abc88 checking point",n,t),!Jt(t,n)&&!a){const i=Kt(t,s,n);f.warn("abc88 inside",n,s,i),f.warn("abc88 intersection",i);let l=!1;e.forEach(o=>{l=l||o.x===i.x&&o.y===i.y}),e.some(o=>o.x===i.x&&o.y===i.y)?f.warn("abc88 no intersect",i,e):e.push(i),a=!0}else f.warn("abc88 outside",n,s),s=n,a||e.push(n)}),f.warn("abc88 returning points",e),e},de=function(r,t,e,s,a,n,i){let l=e.points,o=!1;const c=n.node(t.v);var d=n.node(t.w);f.info("abc88 InsertEdge: ",e),d.intersect&&c.intersect&&(l=l.slice(1,e.points.length-1),l.unshift(c.intersect(l[0])),f.info("Last point",l[l.length-1],d,d.intersect(l[l.length-1])),l.push(d.intersect(l[l.length-1]))),e.toCluster&&(f.info("to cluster abc88",s[e.toCluster]),l=et(e.points,s[e.toCluster].node),o=!0),e.fromCluster&&(f.info("from cluster abc88",s[e.fromCluster]),l=et(l.reverse(),s[e.fromCluster].node).reverse(),o=!0);const h=l.filter(B=>!Number.isNaN(B.y));let g=st;e.curve&&(a==="graph"||a==="flowchart")&&(g=e.curve);const{x:p,y:x}=Ft(e),k=lt().x(p).y(x).curve(g);let w;switch(e.thickness){case"normal":w="edge-thickness-normal";break;case"thick":w="edge-thickness-thick";break;case"invisible":w="edge-thickness-thick";break;default:w=""}switch(e.pattern){case"solid":w+=" edge-pattern-solid";break;case"dotted":w+=" edge-pattern-dotted";break;case"dashed":w+=" edge-pattern-dashed";break}const y=r.append("path").attr("d",k(h)).attr("id",e.id).attr("class"," "+w+(e.classes?" "+e.classes:"")).attr("style",e.style);let b="";switch((u().flowchart.arrowMarkerAbsolute||u().state.arrowMarkerAbsolute)&&(b=window.location.protocol+"//"+window.location.host+window.location.pathname+window.location.search,b=b.replace(/\(/g,"\\("),b=b.replace(/\)/g,"\\)")),f.info("arrowTypeStart",e.arrowTypeStart),f.info("arrowTypeEnd",e.arrowTypeEnd),e.arrowTypeStart){case"arrow_cross":y.attr("marker-start","url("+b+"#"+i+"_"+a+"-crossStart)");break;case"arrow_point":y.attr("marker-start","url("+b+"#"+i+"_"+a+"-pointStart)");break;case"arrow_barb":y.attr("marker-start","url("+b+"#"+i+"_"+a+"-barbStart)");break;case"arrow_circle":y.attr("marker-start","url("+b+"#"+i+"_"+a+"-circleStart)");break;case"aggregation":y.attr("marker-start","url("+b+"#"+i+"_"+a+"-aggregationStart)");break;case"extension":y.attr("marker-start","url("+b+"#"+i+"_"+a+"-extensionStart)");break;case"composition":y.attr("marker-start","url("+b+"#"+i+"_"+a+"-compositionStart)");break;case"dependency":y.attr("marker-start","url("+b+"#"+i+"_"+a+"-dependencyStart)");break;case"lollipop":y.attr("marker-start","url("+b+"#"+i+"_"+a+"-lollipopStart)");break}switch(e.arrowTypeEnd){case"arrow_cross":y.attr("marker-end","url("+b+"#"+i+"_"+a+"-crossEnd)");break;case"arrow_point":y.attr("marker-end","url("+b+"#"+i+"_"+a+"-pointEnd)");break;case"arrow_barb":y.attr("marker-end","url("+b+"#"+i+"_"+a+"-barbEnd)");break;case"arrow_circle":y.attr("marker-end","url("+b+"#"+i+"_"+a+"-circleEnd)");break;case"aggregation":y.attr("marker-end","url("+b+"#"+i+"_"+a+"-aggregationEnd)");break;case"extension":y.attr("marker-end","url("+b+"#"+i+"_"+a+"-extensionEnd)");break;case"composition":y.attr("marker-end","url("+b+"#"+i+"_"+a+"-compositionEnd)");break;case"dependency":y.attr("marker-end","url("+b+"#"+i+"_"+a+"-dependencyEnd)");break;case"lollipop":y.attr("marker-end","url("+b+"#"+i+"_"+a+"-lollipopEnd)");break}let M={};return o&&(M.updatedPath=l),M.originalPath=e.points,M};export{E as B,X as I,Ft as J,L as S,Tt as _,re as a,oe as c,ae as e,de as h,ie as i,le as l,se as n,ee as r,ne as s};
